<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="/web/academyMapper">

	<select id="selectLectGift" parameterType="ak_web.model.web.LectureVo" resultType="int">
	        SELECT nvl(count(*),0) cnt            
             FROM bagifttb                        
             WHERE hq         = '00'                 
               AND store      = '${store}'                 
               AND period     = to_number('${period}') -1   
               AND cust_no    = '${attendCustNo}'                 
               AND gift_class = 'C'                
               AND gift_fg in ('1','2')           
	</select>
	<select id="selectFreeUse" parameterType="ak_web.model.web.LectureVo" resultType="int">
	        SELECT nvl(count(*),0) cnt            
             FROM bafreetb                        
             WHERE hq         = '00'                 
               AND store      = '${store}'                 
               AND period     = '${period}'                 
               AND cust_no    = '${attendCustNo}'                 
               AND pay_yn     = 'Y'                       
	</select>
	<select id="selectLectCntUse" parameterType="ak_web.model.web.LectureVo" resultType="int">
	         select nvl(count(*),0) cnt             
             from batemptb a, bapelttb b            
             where a.hq  = b.hq                     
              and a.store= b.store                  
              and a.subject_cd = b.subject_cd       
              and b.hq      = '00'                     
              and b.store   = '${store}'                     
              and b.period  = '${period}'                     
              and a.cust_no = '${attendCustNo}'                     
              and a.sessionid = '${sessionId}'                   
              and b.lect_cnt <![CDATA[>=]]> 8 
              and a.subject_cd in (${tot_subject_cd})                                     
	</select>
	<select id="selectSubjectEnuriUse" parameterType="ak_web.model.web.LectureVo" resultType="int">
	          select nvl(count(*),0) cnt             
             from batemptb a, bapelttb b            
             where a.hq  = b.hq                     
              and a.store= b.store                  
              and a.subject_cd = b.subject_cd       
              and b.hq      = '00'                     
              and b.store   = '${store}'                     
              and b.period  = '${period}'                     
              and a.cust_no = '${attendCustNo}'                     
              and a.sessionid = '${sessionId}'                   
              and b.enuri_percent <![CDATA[>]]> 0       
              and a.subject_cd in (${tot_subject_cd})                           
	</select>
	<select id="selectPeriodSale" parameterType="ak_web.model.web.LectureVo" resultType="int">
	        SELECT NVL(COUNT(*),0) CNT				
    		 FROM BATRMSTB									
    		 WHERE HQ         = '00'							
    		   AND STORE      = '${store}'							
    		   AND PERIOD     = '${period}'							
    		   AND cust_no    = '${attendCustNo}'							
    		   AND ENURI_AMT1 IN('902','903','144','232','333','422')     
    		   AND SALE_FG    = '01'						
    		   AND CANCEL_YN  = 'N'           			             
	</select>
	<select id="selectTempCompare" parameterType="hashmap" resultType="hashmap">
	        select nvl(sum(regis_fee),0) regis_fee           
             ,nvl(sum(food_amt),0)  food_amt                 
             from BAPELTTB                                   
             where hq         = '00'                            
            and store      = '${login_store}'                               
            and period     = '${login_period}'                               
            and subject_cd  in  (  select subject_cd         
             from batemptb                                   
             where hq        = '00'                             
            and store     = '${login_store}'                                
            and cust_no   = '${login_cust}'                                
            and pay_date is not null                         
            and sessionid = '${login_id}'
            and subject_cd in (${tot_subject_cd}) )             			             
	</select>
	<select id="selectGiftEnuri" parameterType="ak_web.model.web.LectureVo" resultType="hashmap">
	        SELECT GIFT_ENURI_FG
            	,GIFT_USER_ENURI
            	,GIFT_DATE_ENURI
            	,GIFT_DATE_ENURI2
            	,GIFT_DATE_FROM
            	,GIFT_DATE_TO
            	,GIFT_DATE_FROM2
            	,GIFT_DATE_TO2
            FROM BAGIFTMTB   
            WHERE HQ = '00' 		
            AND STORE = '${store}' 		
            AND PERIOD = '${period}'		        			             
	</select>
	<select id="selectPayIngView" parameterType="ak_web.model.web.LectureVo" resultType="hashmap">
		select 
		bapelttb.main_cd,
		bapelttb.subject_cd,
		upper(bapelttb.subject_nm) as subject_nm,
		nvl(bapelttb.food_amt,0) as food_amt,
		bapelttb.regis_fee,
		nvl(bapelttb.food_amt,0) as food_amt,
		nvl(enuri_percent,0) as enuri_percent,
		bapelttb.lect_cnt,
		bapelttb.capacity_no,
		batemptb.p_cust,
		batemptb.c_cust1,
		batemptb.c_cust2
		from bapelttb, batemptb
		where 1=1
		and batemptb.store = bapelttb.store
		and batemptb.subject_cd = bapelttb.subject_cd
		and batemptb.cust_no = '${attendCustNo}'
		and batemptb.sessionid = '${sessionId}'
		and batemptb.hq = '00'
		and bapelttb.hq = '00'
		and bapelttb.store = '${store}'
		and bapelttb.period = '${period}'
		and bapelttb.subject_cd in (${tot_subject_cd})
		
		
<!-- 	    select a.subject_cd                            -->
<!--             ,upper(a.subject_nm) subject_nm                -->
<!--             ,a.regis_fee                                   -->
<!--             ,nvl(a.food_amt,0) food_amt                    -->
<!--             ,nvl(enuri_percent, 0) as enuri_percent        -->
<!--             ,a.lect_cnt                                    -->
<!--             ,a.capacity_no                                   -->
<!--              from BAPELTTB a                               -->
<!--             where a.hq      = '00'                            -->
<!--             and store     = '${store}'                              -->
<!--             and a.period  = '${period}'                              -->
<!--             and exists ( select subject_cd                 -->
<!--             from batemptb                                  -->
<!--             where hq         = '00'                           -->
<!--             and store      = '${store}'                             -->
<!--             and cust_no    = '${attendCustNo}'                             -->
<!--             and sessionid    = '${sessionId}'                           -->
<!--             and hq         = a.hq                          -->
<!--             and store      = a.store                       -->
<!--             and subject_cd = a.subject_cd  -->
<!--             and subject_cd in (${tot_subject_cd}))                -->
	</select>
	<select id="retrievePeriod" parameterType="hashmap" resultType="string">
	    select period from (select period from baperitb where web_open_ymd <![CDATA[<=]]> TO_CHAR(SYSDATE,'YYYYMMDD') and store = '${store}' order by web_open_ymd desc ) where rownum = 1           
	</select>
	<select id="searchUserCi" parameterType="hashmap" resultType="string">
		     select ff.ci                                        
              from (                                             
                    select f.ci                                  
                      from (                                     
                            select a.ci,                         
                                   '1' as cnt                                           
                              from bacusttb a                                
                             where a.hq = '00'                                               
                               and a.store = '${store}'                                            
                               and a.cust_no = '${attendCustNo}'                                
                             union all                           
                            select a.ci,                         
                                   '2' as cnt                                                      
                              from bacusttb a, bachldtb b                                 
                             where a.hq = '00'                                               
                               and a.store = '${store}'                   
                               and a.cust_no = b.p_cust_no                                   
                               and b.c_cust_no = '${attendCustNo}'               
                               and a.hq    = b.hq                                     
                               and a.store  = b.store            
                           ) f                                   
                       where 1=1                                 
                       order by cnt desc                         
                   ) ff                                          
               where rownum='1'                                  
	</select>
	<select id="getCardFg" parameterType="hashmap" resultType="string">
		    SELECT NVL(akrisys.F_PG_CARD_FG@akris('${card_cd}'),'000') AS CARD_FG FROM DUAL                  
	</select>
	<select id="getLectCntCount_01" parameterType="ak_web.model.web.LectureVo" resultType="int">
		    SELECT COUNT(A.SUBJECT_CD) as lect_cnt_count 
                  FROM BATEMPTB A, BAPELTTB B                
                 WHERE A.HQ         = B.HQ                   
                   AND A.STORE      = B.STORE                
                   AND A.SUBJECT_CD = B.SUBJECT_CD           
                   AND B.HQ         = '${hq}'                      
                   AND B.STORE      = '${store}'                      
                   AND B.PERIOD     = '${period}'                      
                   AND A.CUST_NO    = '${attendCustNo}'                      
                   AND A.SESSIONID  = '${sessionId}'                      
                   AND (B.LECT_CNT   <![CDATA[>]]> 9 OR (SUBSTR(B.SUBJECT_CD,1,3) = '620' )) 
	</select>
	<select id="getLectCntCount_02" parameterType="ak_web.model.web.LectureVo" resultType="int">
		    SELECT COUNT(A.SUBJECT_CD) as lect_cnt_count 
                  FROM BATEMPTB A, BAPELTTB B                
                 WHERE A.HQ         = B.HQ                   
                   AND A.STORE      = B.STORE                
                   AND A.SUBJECT_CD = B.SUBJECT_CD           
                   AND B.HQ         = '${hq}'                            
                   AND B.STORE      = '${store}'                         
                   AND B.PERIOD     = '${period}'                        
                   AND A.CUST_NO    = '${attendCustNo}'                  
                   AND A.SESSIONID  = '${sessionId}'                     
                   AND (B.LECT_CNT   <![CDATA[>]]> 7 )                   
	</select>
	<select id="getLectCntCount_03" parameterType="ak_web.model.web.LectureVo" resultType="int">
		    SELECT COUNT(A.SUBJECT_CD) as lect_cnt_count 
                  FROM BATEMPTB A, BAPELTTB B                
                 WHERE A.HQ         = B.HQ                   
                   AND A.STORE      = B.STORE                
                   AND A.SUBJECT_CD = B.SUBJECT_CD           
                   AND B.HQ         = '${hq}'                              
                   AND B.STORE      = '${store}'                           
                   AND B.PERIOD     = '${period}'                          
                   AND A.CUST_NO    = '${attendCustNo}'                    
                   AND A.SESSIONID  = '${sessionId}'                       
                   AND (substr(B.SUBJECT_CD,1,3) <![CDATA[<>]]> '414') AND (B.LECT_CNT  <![CDATA[>]]> 9 OR ( B.SUBJECT_CD in ('620001','620002')) ) 
	</select>
	<select id="getLectCntCount_04" parameterType="ak_web.model.web.LectureVo" resultType="int">
		    SELECT COUNT(A.SUBJECT_CD) as lect_cnt_count 
                  FROM BATEMPTB A, BAPELTTB B                
                 WHERE A.HQ         = B.HQ                   
                   AND A.STORE      = B.STORE                
                   AND A.SUBJECT_CD = B.SUBJECT_CD           
                   AND B.HQ         = '${hq}'                               
                   AND B.STORE      = '${store}'                            
                   AND B.PERIOD     = '${period}'                           
                   AND A.CUST_NO    = '${attendCustNo}'                     
                   AND A.SESSIONID  = '${sessionId}'                        
                   AND (B.LECT_CNT   <![CDATA[>]]> 9 OR (SUBSTR(B.SUBJECT_CD,1,3) = '620')) 
	</select>
	<select id="getLectCntCount_05" parameterType="ak_web.model.web.LectureVo" resultType="int">
		    SELECT COUNT(A.SUBJECT_CD) as lect_cnt_count 
                  FROM BATEMPTB A, BAPELTTB B                
                 WHERE A.HQ         = B.HQ                   
                   AND A.STORE      = B.STORE                
                   AND A.SUBJECT_CD = B.SUBJECT_CD           
                   AND B.HQ         = '${hq}'                           
                   AND B.STORE      = '${store}'                        
                   AND B.PERIOD     = '${period}'                       
                   AND A.CUST_NO    = '${attendCustNo}'                 
                   AND A.SESSIONID  = '${sessionId}'                    
                   AND (B.LECT_CNT   <![CDATA[>]]> 9 OR (SUBSTR(B.SUBJECT_CD,1,3) = '620')) 
	</select>
	<select id="getCustFg" parameterType="ak_web.model.web.LectureVo" resultType="hashmap">
		     SELECT MIN(PERIOD)  AS COUNT  
                  FROM BAPERETB         
                 WHERE HQ           =  '${hq}'   
                   AND STORE        =  '${store}'   
                   AND cust_no    =  '${attendCustNo}'   
                   AND PERIOD       <![CDATA[<]]>  '${period}'   
                   GROUP BY CUST_NO   
	</select>
	<select id="getGiftCnt" parameterType="ak_web.model.web.LectureVo" resultType="hashmap">
		      SELECT NVL(GIFT_CNT1,0) AS GIFT_CNT1,                                  							 
                        NVL(GIFT_CNT2,0) AS GIFT_CNT2,                                     							 
                        NVL(GIFT_CNT3,0) AS GIFT_CNT3,                            						      		 
                        NVL(GIFT_CNT4,0) AS GIFT_CNT4,                                					       		 
                        NVL(GIFT_CLASS3_CNT,0) AS GIFT_CLASS3_CNT,                  							 
                        NVL(GIFT_CNT0,0) AS GIFTA_ALLCNT,                                  					   		 
                        CASE WHEN                                                           						  			  
                             SYSDATE <![CDATA[<=]]> TO_DATE(GIFT_WDATE || GIFT_STIME, 'YYYYMMDD HH24MISS')  
                		       OR SYSDATE > TO_DATE(NEW_SDATE, 'YYYYMMDD HH24MISS')   					 
                             THEN 0 ELSE NVL(GIFT_CNT0_W,0) END AS  EXIST_CNT_W,   						 
                        CASE WHEN                                                			   					        		 
                   		  SYSDATE <![CDATA[<=]]> TO_DATE(NEW_SDATE, 'YYYYMMDD HH24MISS')		  				 
                  			  THEN 0 ELSE NVL(GIFT_CNT0_W+NEW_CNT_W,0) END AS  NEW_CNT_W			 
                   FROM BAGIFTMTB                                                     						        		 
                  WHERE HQ       = '${hq}'                                                     										 
                    AND STORE    = '${store}'                                               		        							 
                    AND PERIOD   = '${period}'                                                		   						  			 
	</select>
	<select id="getGiftFg" parameterType="ak_web.model.web.LectureVo" resultType="hashmap">
		       SELECT GIFT_FG       
                   FROM BAGIFTTB                               
                  WHERE HQ       = '${hq}'                           
                    AND STORE    = '${store}'                           
                    AND PERIOD   = '${period}'                           
                    AND cust_no  = '${attendCustNo}'                           
                    AND GIFT_CLASS  = 'A'                        
                    AND GIFT_SEQ = '1'                                                                 		   						  			 
	</select>
	<select id="getAllCreateCnt" parameterType="ak_web.model.web.LectureVo" resultType="int">
		       SELECT COUNT(CUST_NO) AS ALLCREATECNT             
                       FROM BAGIFTTB                         
                      WHERE HQ       = '${hq}'                     
                        AND STORE    = '${store}'                     
                        AND PERIOD   = '${period}'                     
                        AND GIFT_CLASS  = 'A'                                                                      		   						  			 
	</select>
	<select id="getWebCount" parameterType="ak_web.model.web.LectureVo" resultType="int">
		       SELECT COUNT(*) AS WEBCOUNT             
                               FROM BAGIFTTB                         
                              WHERE HQ       = '${hq}'                     
                                AND STORE    = '${store}'                     
                                AND PERIOD   = '${period}'                     
                                AND GIFT_CLASS  = 'A'                 
                                AND GUBUN IN('W','M')                                                                                  		   						  			 
	</select>
	<update id="upGiftRet" parameterType="ak_web.model.web.LectureVo">
		        UPDATE BAGIFTTB                                             
                                         SET GIFT_FG  = '2'                                      
                                             ,UPDATE_RESI_NO = 'CULTURE_WEBRE'                    
                                             ,UPDATE_DATE = TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')  
                                             ,CONTENTS = CONTENTS||' / WEB_재결제'  
                                             ,POS_NO = '070013'                                        
                                             ,GUBUN = 'W'                                        
                                       WHERE HQ          = '${hq}'                                      
                                         AND STORE       = '${store}'                                      
                                         AND PERIOD      = '${period}'                                      
                                         AND cust_no     = '${attendCustNo}'                                      
                                         AND GIFT_CLASS  = 'A'                                      
                                         AND GIFT_FG   IN ('0','9')                                                                                                                      		   						  			 
	</update>
	<insert id="insGiftRet" parameterType="hashmap">
		         INSERT INTO BAGIFTTB                                                      							         
                                                 (HQ, STORE, PERIOD, GIFT_CLASS,                         							             
                                                 CUST_NO, CUST_FG, GIFT_SEQ,                              							             
                                                  GIFT_FG, GIFT_DATE,CREATE_RESI_NO,                 		                                 
                                                  CREATE_DATE,POS_NO, GUBUN, CLASS_SEQ)             				                     
                                     SELECT '${hq}', '${store}', '${period}', 'A',																								 
                                      '${attendCustNo}', NVL('${cust_fg}', 3),NVL(MAX(b.GIFT_SEQ),0)+1, 																 
                                      '2', TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'), 'CULTURE_WEB',									 
                                      TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'), '070013', 'W', NVL(MAX(TO_NUMBER(A.CLASS_SEQ)),0)+1	 
                                      FROM BAGIFTTB A, 																								 
                                       ( SELECT NVL(MAX(GIFT_SEQ), 0) AS GIFT_SEQ														 
                                      		FROM BAGIFTTB    																							 
                                      	  WHERE HQ             = '${hq}'                  	          															 
                                      		AND STORE          = '${store}'                             															 
                                      		AND PERIOD         = '${period}'                 	              														 
                                     		 AND GIFT_CLASS = 'A'																						 
                                     		 AND cust_no     = '${attendCustNo}' ) B																					 
                                      WHERE HQ          = '${hq}'                          																 
                                      AND STORE         = '${store}'                       																 
                                      AND PERIOD        = '${period}'                      																 
                                      AND GIFT_CLASS = 'A'																							                                                                                                          		   						  			 
	</insert>
	<select id="getClassBCount_01" parameterType="ak_web.model.web.LectureVo" resultType="int">
		        SELECT COUNT(*) AS COUNT                                           
                        FROM BAPERETB A, BAPELTTB B , BATRCATB C                         
                       WHERE A.HQ          = '${hq}'                                           
                         AND A.STORE       = '${store}'                                           
                         AND A.PERIOD      = '${period}'                                           
                         AND A.CUST_NO     = '${attendCustNo}'                                           
                         AND A.PAY_YN      = 'Y'                                         
                         AND A.REGIS_CANCEL_FG = '1'                                     
                         AND C.CARD_CORP_NO  ='822'                                      
                         AND (B.LECT_CNT   <![CDATA[>]]> 9 OR (SUBSTR(B.SUBJECT_CD,1,3) = '620'))    
                         AND A.HQ          = B.HQ                                        
                         AND A.HQ          = C.HQ                                        
                         AND A.STORE       = B.STORE                                     
                         AND A.STORE       = C.STORE                                     
                         AND A.SALE_YMD    = C.SALE_YMD                                  
                         AND A.POS_NO      = C.POS_NO                                    
                         AND A.RECPT_NO    = C.RECPT_NO                                  
                         AND A.SUBJECT_CD  = B.SUBJECT_CD                                
                         AND A.PERIOD      = B.PERIOD                                    
                       GROUP BY A.PERIOD                                                                                                                                		   						  			 
	</select>
	<select id="getClassBCount_02" parameterType="ak_web.model.web.LectureVo" resultType="int">
		          SELECT COUNT(*) AS COUNT                                           
                        FROM BAPERETB A, BAPELTTB B , BATRCATB C                         
                       WHERE A.HQ          = '${hq}'                                                     
                         AND A.STORE       = '${store}'                                                  
                         AND A.PERIOD      = '${period}'                                                 
                         AND A.CUST_NO     = '${attendCustNo}'                                           
                         AND A.PAY_YN      = 'Y'                                         
                         AND A.REGIS_CANCEL_FG = '1'                                     
                         AND C.CARD_CORP_NO  ='822'                        
                         AND (B.LECT_CNT   <![CDATA[>]]> 7 )                                        
                         AND A.HQ          = B.HQ                                        
                         AND A.HQ          = C.HQ                                        
                         AND A.STORE       = B.STORE                                     
                         AND A.STORE       = C.STORE                                     
                         AND A.SALE_YMD    = C.SALE_YMD                                  
                         AND A.POS_NO      = C.POS_NO                                    
                         AND A.RECPT_NO    = C.RECPT_NO                                  
                         AND A.SUBJECT_CD  = B.SUBJECT_CD                                
                         AND A.PERIOD      = B.PERIOD                                    
                       GROUP BY A.PERIOD                                                                                                                                                                             		   						  			 
	</select>
	<select id="getClassBCount_03" parameterType="ak_web.model.web.LectureVo" resultType="int">
		          SELECT COUNT(*) AS COUNT                                           
                        FROM BAPERETB A, BAPELTTB B , BATRCATB C                         
                       WHERE A.HQ          = '${hq}'                                                     
                         AND A.STORE       = '${store}'                                                  
                         AND A.PERIOD      = '${period}'                                                 
                         AND A.CUST_NO     = '${attendCustNo}'                                           
                         AND A.PAY_YN      = 'Y'                                         
                         AND A.REGIS_CANCEL_FG = '1'                                     
                         AND C.CARD_CORP_NO  ='822'                                      
                         AND (substr(B.SUBJECT_CD,1,3) <![CDATA[<>]]> '414') AND (B.LECT_CNT  <![CDATA[>]]> 9 OR ( B.SUBJECT_CD in ('620001','620002')) ) 
                         AND A.HQ          = B.HQ                                        
                         AND A.HQ          = C.HQ                                        
                         AND A.STORE       = B.STORE                                     
                         AND A.STORE       = C.STORE                                     
                         AND A.SALE_YMD    = C.SALE_YMD                                  
                         AND A.POS_NO      = C.POS_NO                                    
                         AND A.RECPT_NO    = C.RECPT_NO                                  
                         AND A.SUBJECT_CD  = B.SUBJECT_CD                                
                         AND A.PERIOD      = B.PERIOD                                    
                       GROUP BY A.PERIOD                                                                                                                                                                             		   						  			 
	</select>
	<select id="getClassBCount_04" parameterType="ak_web.model.web.LectureVo" resultType="int">
		          SELECT COUNT(*) AS COUNT                                           
                        FROM BAPERETB A, BAPELTTB B , BATRCATB C                         
                       WHERE A.HQ          = '${hq}'                                                     
                         AND A.STORE       = '${store}'                                                  
                         AND A.PERIOD      = '${period}'                                                 
                         AND A.CUST_NO     = '${attendCustNo}'                                           
                         AND A.PAY_YN      = 'Y'                                         
                         AND A.REGIS_CANCEL_FG = '1'                                     
                         AND C.CARD_CORP_NO  ='822'                                      
                         AND (B.LECT_CNT   <![CDATA[>]]> 9 OR (SUBSTR(B.SUBJECT_CD,1,3) = '620' ))   
                         AND A.HQ          = B.HQ                                        
                         AND A.HQ          = C.HQ                                        
                         AND A.STORE       = B.STORE                                     
                         AND A.STORE       = C.STORE                                     
                         AND A.SALE_YMD    = C.SALE_YMD                                  
                         AND A.POS_NO      = C.POS_NO                                    
                         AND A.RECPT_NO    = C.RECPT_NO                                  
                         AND A.SUBJECT_CD  = B.SUBJECT_CD                                
                         AND A.PERIOD      = B.PERIOD                                    
                       GROUP BY A.PERIOD                                                                                                                                                                    		   						  			 
	</select>
	<select id="getClassBCount_05" parameterType="ak_web.model.web.LectureVo" resultType="int">
		          SELECT COUNT(*) AS COUNT                                           
                        FROM BAPERETB A, BAPELTTB B , BATRCATB C                         
                       WHERE A.HQ          = '${hq}'                                                    
                         AND A.STORE       = '${store}'                                                 
                         AND A.PERIOD      = '${period}'                                                
                         AND A.CUST_NO     = '${attendCustNo}'                                          
                         AND A.PAY_YN      = 'Y'                                         
                         AND A.REGIS_CANCEL_FG = '1'                                     
                         AND C.CARD_CORP_NO  ='822'                                      
                         AND (B.LECT_CNT   <![CDATA[>]]> 9 OR (SUBSTR(B.SUBJECT_CD,1,3) = '620' ))   
                         AND A.HQ          = B.HQ                                        
                         AND A.HQ          = C.HQ                                        
                         AND A.STORE       = B.STORE                                     
                         AND A.STORE       = C.STORE                                     
                         AND A.SALE_YMD    = C.SALE_YMD                                  
                         AND A.POS_NO      = C.POS_NO                                    
                         AND A.RECPT_NO    = C.RECPT_NO                                  
                         AND A.SUBJECT_CD  = B.SUBJECT_CD                                
                         AND A.PERIOD      = B.PERIOD                                    
                       GROUP BY A.PERIOD                                                                                                                                                                		   						  			 
	</select>
	<select id="getWbtrtbCount_01" parameterType="ak_web.model.web.LectureVo" resultType="int">
		            SELECT COUNT(*) AS COUNT                                           
                        FROM BAWBTRTB A, BAPELTTB B                                      
                       WHERE A.HQ      = '${hq}'                                                         
                         AND A.STORE   = '${store}'                                                      
                         AND A.PERIOD  = '${period}'                                                     
                         AND A.CUST_NO = '${attendCustNo}'                                               
                         AND A.SEND_YN = 'N'                                             
                         AND A.PAY_METHOD = '822'                                        
                         AND (B.LECT_CNT   <![CDATA[>]]> 9 OR (SUBSTR(B.SUBJECT_CD,1,3) = '620' ))   
                         AND A.HQ          = B.HQ                                        
                         AND A.STORE       = B.STORE                                     
                         AND A.SUBJECT_CD  = B.SUBJECT_CD                                
                         AND A.PERIOD      = B.PERIOD                                    
                       GROUP BY A.PERIOD                                                                                                                                                                                                               		   						  			 
	</select>
	<select id="getWbtrtbCount_02" parameterType="ak_web.model.web.LectureVo" resultType="int">
		             SELECT COUNT(*) AS COUNT                                           
                        FROM BAWBTRTB A, BAPELTTB B                                      
                       WHERE A.HQ      = '${hq}'                                                         
                         AND A.STORE   = '${store}'                                                      
                         AND A.PERIOD  = '${period}'                                                     
                         AND A.CUST_NO = '${attendCustNo}'                                               
                         AND A.SEND_YN = 'N'                                             
                         AND A.PAY_METHOD = '822'                                         
                         AND (B.LECT_CNT   <![CDATA[>]]> 7 )                                          
                         AND A.HQ          = B.HQ                                        
                         AND A.STORE       = B.STORE                                     
                         AND A.SUBJECT_CD  = B.SUBJECT_CD                                
                         AND A.PERIOD      = B.PERIOD                                    
                       GROUP BY A.PERIOD                                                                                                                                                                                                      		   						  			 
	</select>
	<select id="getWbtrtbCount_03" parameterType="ak_web.model.web.LectureVo" resultType="int">
		            SELECT COUNT(*) AS COUNT                                           
                        FROM BAWBTRTB A, BAPELTTB B                                      
                       WHERE A.HQ      = '${hq}'                                                         
                         AND A.STORE   = '${store}'                                                      
                         AND A.PERIOD  = '${period}'                                                     
                         AND A.CUST_NO = '${attendCustNo}'                                               
                         AND A.SEND_YN = 'N'                                             
                         AND A.PAY_METHOD = '822'                                        
                         AND (substr(B.SUBJECT_CD,1,3) <![CDATA[<>]]> '414') AND (B.LECT_CNT  <![CDATA[>]]> 9 OR ( B.SUBJECT_CD in ('620001','620002')) ) 
                         AND A.HQ          = B.HQ                                        
                         AND A.STORE       = B.STORE                                     
                         AND A.SUBJECT_CD  = B.SUBJECT_CD                                
                         AND A.PERIOD      = B.PERIOD                                    
                       GROUP BY A.PERIOD                                                                                                                                                                                     		   						  			 
	</select>
	<select id="getWbtrtbCount_04" parameterType="ak_web.model.web.LectureVo" resultType="int">
		            SELECT COUNT(*) AS COUNT                                           
                        FROM BAWBTRTB A, BAPELTTB B                                      
                       WHERE A.HQ      = '${hq}'                                                         
                         AND A.STORE   = '${store}'                                                      
                         AND A.PERIOD  = '${period}'                                                     
                         AND A.CUST_NO = '${attendCustNo}'                                               
                         AND A.SEND_YN = 'N'                                             
                         AND A.PAY_METHOD = '822'                                        
                         AND (B.LECT_CNT   <![CDATA[>]]> 9 OR (SUBSTR(B.SUBJECT_CD,1,3) = '620' ))   
                         AND A.HQ          = B.HQ                                        
                         AND A.STORE       = B.STORE                                     
                         AND A.SUBJECT_CD  = B.SUBJECT_CD                                
                         AND A.PERIOD      = B.PERIOD                                    
                       GROUP BY A.PERIOD                                                                                                                                                                    		   						  			 
	</select>
	<select id="getWbtrtbCount_05" parameterType="ak_web.model.web.LectureVo" resultType="int">
		            SELECT COUNT(*) AS COUNT                                           
                        FROM BAWBTRTB A, BAPELTTB B                                      
                       WHERE A.HQ      = '${hq}'                                                         
                         AND A.STORE   = '${store}'                                                      
                         AND A.PERIOD  = '${period}'                                                     
                         AND A.CUST_NO = '${attendCustNo}'                                               
                         AND A.SEND_YN = 'N'                                             
                         AND A.PAY_METHOD = '822'                                        
                         AND (B.LECT_CNT   <![CDATA[>]]> 9 OR (SUBSTR(B.SUBJECT_CD,1,3) = '620' ))   
                         AND A.HQ          = B.HQ                                        
                         AND A.STORE       = B.STORE                                     
                         AND A.SUBJECT_CD  = B.SUBJECT_CD                                
                         AND A.PERIOD      = B.PERIOD                                    
                       GROUP BY A.PERIOD                                                                                                                                                              		   						  			 
	</select>
	<select id="getLectCntCount2" parameterType="ak_web.model.web.LectureVo" resultType="int">
		                 SELECT COUNT(*) AS lect_cnt_count2   
                      FROM BAGIFTTB                      
                     WHERE HQ       = '${hq}'                  
                       AND STORE    = '${store}'                  
                       AND PERIOD   = '${period}'                  
                       AND GIFT_CLASS = 'B'                                                                                                                                                           		   						  			 
	</select>
	<select id="getGiftRetList" parameterType="ak_web.model.web.LectureVo" resultType="hashmap">
		               SELECT HQ, STORE, cust_no AS GIFT_COUNT       
                           FROM BAGIFTTB                               
                          WHERE HQ       = '${hq}'                                     
                            AND STORE    = '${store}'                                  
                            AND PERIOD   = '${period}'                                 
                            AND cust_no  = '${attendCustNo}'                           
                            AND GIFT_CLASS  = 'B'                        
                            AND GIFT_FG  <![CDATA[<>]]> '0'                                                                                                                                                                            		   						  			 
	</select>
	<select id="getGiftRetList2" parameterType="ak_web.model.web.LectureVo" resultType="hashmap">
		               SELECT HQ, STORE, cust_no AS GIFT_COUNT    
                               FROM BAGIFTTB                            
                              WHERE HQ       = '${hq}'                                  
                                AND STORE    = '${store}'                               
                                AND PERIOD   = '${period}'                              
                                AND cust_no  = '${attendCustNo}'                        
                                AND GIFT_CLASS  = 'B'                     
                                AND GIFT_FG  = '0'                                                                                                                                                                                                  		   						  			 
	</select>
	<update id="upGiftList" parameterType="ak_web.model.web.LectureVo">
		          UPDATE BAGIFTTB                                             
                                     SET GIFT_FG  = '2',                                      
                                         UPDATE_RESI_NO = '7778889999000',                    
                                         UPDATE_DATE = TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'),  
                                         POS_NO = null                                        
                                   WHERE HQ          = '${hq}'                                                
                                     AND STORE       = '${store}'                                             
                                     AND PERIOD      = '${period}'                                            
                                     AND cust_no     = '${attendCustNo}'                                      
                                     AND GIFT_CLASS  = 'B'                                      
                                     AND GIFT_FG     = '0'                                    
                                                                                                               		   						  			 
	</update>
	<insert id="insGiftList" parameterType="ak_web.model.web.LectureVo">
		            INSERT INTO BAGIFTTB                                                             
                                             (HQ, STORE, PERIOD, GIFT_CLASS,                                       
                                              CUST_NO, CUST_FG, GIFT_SEQ,                                          
                                              GIFT_FG, GIFT_DATE,                                                  
                                              CREATE_RESI_NO, CREATE_DATE, CONTENTS, GUBUN)                        
                                       VALUES ('${hq}', '${store}', '${period}', 'B',                                                         
                                               '${attendCustNo}',   '3',     (SELECT NVL(MAX(GIFT_SEQ), 0) + 1 FROM BAGIFTTB       
                                                               WHERE HQ         = '${hq}'                                
                                                                 AND STORE      = '${store}'                                
                                                                 AND PERIOD     = '${period}'                                
                                                                 AND GIFT_CLASS = 'B'                                
                                                                 AND cust_no    = '${attendCustNo}'),                              
                                               '2', TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'),                          
                                               '7778889999000', TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'), '1만원 상품권', 'W' )                     
                                                                                                               		   						  			 
	</insert>
	<select id="getContinueCount_01" parameterType="ak_web.model.web.LectureVo" resultType="int">
		                SELECT NVL(SUM(COUNT(*)), 0) AS COUNT                                                          
                           FROM                                                                                         
                               (                                                                                        
                                 SELECT A.PERIOD, COUNT(*)                                                              
                                  FROM BAPERETB A, BAPELTTB B                                                           
                                 WHERE A.HQ          = '${hq}'                                                                
                                  AND A.STORE       = '${store}'                                                                 
                                  AND A.PERIOD BETWEEN trim(TO_CHAR((${period} - ${gift_cnt}), '000')) AND trim(TO_CHAR((${period} - 1), '000'))  
                                  AND A.CUST_NO     = '${attendCustNo}'                                                                 
                                  AND A.PAY_YN      = 'Y'                                                               
                                  AND A.REGIS_CANCEL_FG = '1'                                                           
                                  AND (B.LECT_CNT   <![CDATA[>]]> 9 OR (substr(B.SUBJECT_CD,1,3) = '620' )) 
                                  AND A.HQ          = B.HQ                                                              
                                  AND A.STORE       = B.STORE                                                           
                                  AND A.SUBJECT_CD  = B.SUBJECT_CD                                                      
                                  AND A.PERIOD      = B.PERIOD                                                          
                                GROUP BY A.PERIOD                                                                       
                               )                                                                                        
                          GROUP BY PERIOD                                                                                                                                                                                                   		   						  			 
	</select>
	<select id="getContinueCount_02" parameterType="ak_web.model.web.LectureVo" resultType="int">
		                SELECT NVL(SUM(COUNT(*)), 0) AS COUNT                                                          
                               FROM                                                                                         
                                   (                                                                                        
                                     SELECT A.PERIOD, COUNT(*)                                                              
                                      FROM BAPERETB A, BAPELTTB B                                                           
                                     WHERE A.HQ          = '${hq}'                                                                
                                      AND A.STORE       = '${store}'                                                                 
                                      AND A.PERIOD BETWEEN trim(TO_CHAR((${period} - ${gift_cnt}), '000')) AND trim(TO_CHAR((${period} - 1), '000'))  
                                      AND A.CUST_NO     = '${attendCustNo}'                                                                 
                                      AND A.PAY_YN      = 'Y'                                                               
                                      AND A.REGIS_CANCEL_FG = '1'                                                           
                                      AND (B.LECT_CNT   <![CDATA[>]]> 9 AND substr(B.SUBJECT_CD,1,3) NOT IN('120','205')) 
                                      AND A.HQ          = B.HQ                                                              
                                      AND A.STORE       = B.STORE                                                           
                                      AND A.SUBJECT_CD  = B.SUBJECT_CD                                                      
                                      AND A.PERIOD      = B.PERIOD                                                          
                                    GROUP BY A.PERIOD                                                                       
                                   )                                                                                        
                              GROUP BY PERIOD     
                          GROUP BY PERIOD                                                                                                                                                                                                   		   						  			 
	</select>
	<select id="getContinueCount_03" parameterType="ak_web.model.web.LectureVo" resultType="int">
		                SELECT NVL(SUM(COUNT(*)), 0) AS COUNT                                                          
                           FROM                                                                                         
                               (                                                                                        
                                 SELECT A.PERIOD, COUNT(*)                                                              
                                  FROM BAPERETB A, BAPELTTB B                                                           
                                 WHERE A.HQ          = '${hq}'                                                                
                                  AND A.STORE       = '${store}'                                                                 
                                  AND A.PERIOD BETWEEN trim(TO_CHAR((${period} - ${gift_cnt}), '000')) AND trim(TO_CHAR((${period} - 1), '000'))  
                                  AND A.CUST_NO     = '${attendCustNo}'                                                                 
                                  AND A.PAY_YN      = 'Y'                                                               
                                  AND (A.REGIS_CANCEL_FG = '1' or  ( A.REGIS_CANCEL_FG = '3' and A.period ='072' and A.subject_cd in ('207137','207138','207139','207164','207165','207166') and A.pay_yn ='Y')) 
                                  AND (substr(B.SUBJECT_CD,1,3) <![CDATA[<>]]> '414') AND (B.LECT_CNT  <![CDATA[>]]> 9 OR ( B.SUBJECT_CD in ('620001','620002')) ) 
                                  AND A.HQ          = B.HQ                                                              
                                  AND A.STORE       = B.STORE                                                           
                                  AND A.SUBJECT_CD  = B.SUBJECT_CD                                                      
                                  AND A.PERIOD      = B.PERIOD                                                          
                                GROUP BY A.PERIOD                                                                       
                               )                                                                                        
                          GROUP BY PERIOD                                                                                                                                  		   						  			 
	</select>
	<select id="getContinueCount_04" parameterType="ak_web.model.web.LectureVo" resultType="int">
		               SELECT NVL(SUM(COUNT(*)), 0) AS COUNT                                                          
                           FROM                                                                                         
                               (                                                                                        
                                 SELECT A.PERIOD, COUNT(*)                                                              
                                  FROM BAPERETB A, BAPELTTB B                                                           
                                 WHERE A.HQ          = '${hq}'                                                                
                                  AND A.STORE       = '${store}'                                                                 
                                  AND A.PERIOD BETWEEN trim(TO_CHAR((${period} - ${gift_cnt}), '000')) AND trim(TO_CHAR((${period} - 1), '000'))  
                                  AND A.CUST_NO     = '${attendCustNo}'                                                                 
                                  AND A.PAY_YN      = 'Y'                                                               
                                  AND A.REGIS_CANCEL_FG = '1'                                                           
                                  AND (B.LECT_CNT   <![CDATA[>]]> 9 OR (substr(B.SUBJECT_CD,1,3) = '620' )) 						
                                  AND A.HQ          = B.HQ                                                              
                                  AND A.STORE       = B.STORE                                                           
                                  AND A.SUBJECT_CD  = B.SUBJECT_CD                                                      
                                  AND A.PERIOD      = B.PERIOD                                                          
                                GROUP BY A.PERIOD                                                                       
                               )                                                                                        
                          GROUP BY PERIOD                                                                                                                                                                                            		   						  			 
	</select>
	<select id="getContinueCount_05" parameterType="ak_web.model.web.LectureVo" resultType="int">
		                SELECT NVL(SUM(COUNT(*)), 0) AS COUNT                                                          
                           FROM                                                                                         
                               (                                                                                        
                                 SELECT A.PERIOD, COUNT(*)                                                              
                                  FROM BAPERETB A, BAPELTTB B                                                           
                                 WHERE A.HQ          = '${hq}'                                                                
                                  AND A.STORE       = '${store}'                                                                 
                                  AND A.PERIOD BETWEEN trim(TO_CHAR((${period} - ${gift_cnt}), '000')) AND trim(TO_CHAR((${period} - 1), '000'))  
                                  AND A.CUST_NO     = '${attendCustNo}'                                                                 
                                  AND A.PAY_YN      = 'Y'                                                               
                                  AND A.REGIS_CANCEL_FG = '1'                                                           
                                  AND (B.LECT_CNT   <![CDATA[>]]> 9 OR (substr(B.SUBJECT_CD,1,3) = '620' )) 						
                                  AND A.HQ          = B.HQ                                                              
                                  AND A.STORE       = B.STORE                                                           
                                  AND A.SUBJECT_CD  = B.SUBJECT_CD                                                      
                                  AND A.PERIOD      = B.PERIOD                                                          
                                GROUP BY A.PERIOD                                                                       
                               )                                                                                        
                          GROUP BY PERIOD                                                                                                                                                                                          		   						  			 
	</select>
	<select id="getGiftRetList3" parameterType="ak_web.model.web.LectureVo" resultType="hashmap">
		                SELECT HQ, STORE, cust_no AS GIFT_COUNT       
                       FROM BAGIFTTB                               
                      WHERE HQ       = '${hq}'                           
                        AND STORE    = '${store}'                           
                        AND PERIOD   = '${period}'                           
                        AND cust_no  = '${attendCustNo}'                           
                        AND GIFT_CLASS  = 'C'                        
                        AND GIFT_FG  not in('0', '9')                                                                                                                                                                                               		   						  			 
	</select>
	<select id="getGiftRetList4" parameterType="ak_web.model.web.LectureVo" resultType="hashmap">
		                SELECT HQ, STORE, cust_no AS GIFT_COUNT    
                           FROM BAGIFTTB                            
                          WHERE HQ       = '${hq}'                        
                            AND STORE    = '${store}'                        
                            AND PERIOD   = '${period}'                        
                            AND cust_no  = '${attendCustNo}'                        
                            AND GIFT_CLASS  = 'C'                     
                            AND GIFT_FG  in('0', '9')                                                                                                                                                                                                           		   						  			 
	</select>
	<select id="getAKmemRecptNo_01" parameterType="ak_web.model.web.LectureVo" resultType="string">
		SELECT TO_CHAR( akmem_recpt_no_01.NEXTVAL,'FM0000') akmem_recpt_no FROM DUAL                                                                              		   						  			 
	</select>
	<select id="getAKmemRecptNo_02" parameterType="ak_web.model.web.LectureVo" resultType="string">
		SELECT TO_CHAR( akmem_recpt_no_02.NEXTVAL,'FM0000') akmem_recpt_no FROM DUAL                                                                              		   						  			 
	</select>
	<select id="getAKmemRecptNo_03" parameterType="ak_web.model.web.LectureVo" resultType="string">
		SELECT TO_CHAR( akmem_recpt_no_03.NEXTVAL,'FM0000') akmem_recpt_no FROM DUAL                                                                              		   						  			 
	</select>
	<select id="getAKmemRecptNo_04" parameterType="ak_web.model.web.LectureVo" resultType="string">
		SELECT TO_CHAR( akmem_recpt_no_04.NEXTVAL,'FM0000') akmem_recpt_no FROM DUAL                                                                              		   						  			 
	</select>
	<select id="getAKmemRecptNo_05" parameterType="ak_web.model.web.LectureVo" resultType="string">
		SELECT TO_CHAR( akmem_recpt_no_05.NEXTVAL,'FM0000') akmem_recpt_no FROM DUAL                                                                              		   						  			 
	</select>
	<select id="akMemberPercent" parameterType="hashmap" resultType="string">
		SELECT long_name                          
             FROM bacodetb                            
             WHERE code_fg = '25'                     
             AND sub_code     = '${subcode}'                                                                    		   						  			 
	</select>
	<select id="getFreeUseCnt" parameterType="ak_web.model.web.LectureVo" resultType="int">
		SELECT nvl(count(*),0) cnt            
             FROM bafreetb                        
             WHERE hq         = '${hq}'                 
               AND store      = '${store}'                 
               AND period     = '${period}'                 
               AND cust_no    = '${attendCustNo}'                 
               AND pay_yn     = 'Y'                                                                               		   						  			 
	</select>
	<select id="nextSeqMail" parameterType="hashmap" resultType="int">
		select max(to_number(automail_id)) as automail_id from bamailtb                                                                        		   						  			 
	</select>
	<select id="getPayCnt" parameterType="ak_web.model.web.LectureVo" resultType="int">
		 select nvl(count(*),0) pay_cnt   
             from bawbtrtb a, bacusttb b     
             where a.hq = b.hq               
               and a.store = b.store         
               and a.cust_no = b.cust_no     
               and a.hq  = '${hq}'                 
               and a.store = '${store}'               
               and a.period = '${period}'              
               and a.cust_no = '${attendCustNo}'             
               and a.sale_ymd = '${sale_ymd}'            
               and a.sale_time = '${sale_time}'           
               and a.sale_fg ='01'                                                                   		   						  			 
	</select>
	<select id="getPEmail_addr" parameterType="ak_web.model.web.LectureVo" resultType="string">
		  select trim(email_addr) as p_email_addr            
              from bacusttb#                                    
             where hq = '${hq}'                                       
               and store = '${store}'                                    
               and cust_no = (select p_cust_no                         
                                from bachldtb                           
                                where hq = '${hq}'                                
                                  and store = '${store}'                             
                                  and c_cust_no ='${attendCustNo}'                                                   
                                  and rownum <![CDATA[<]]> 2 )                                                                            		   						  			 
	</select>
	<select id="getCEmail_addr" parameterType="ak_web.model.web.LectureVo" resultType="string">
		  select trim(email_addr) as c_email_addr            
                  from bacusttb#                                    
                 where hq = '${hq}'                                       
                   and store = '${store}'                                    
                   and cust_no = '${attendCustNo}'                                                                                                       		   						  			 
	</select>
	<update id="upGiftRet2" parameterType="ak_web.model.web.LectureVo">
		          UPDATE BAGIFTTB                                             
                                 SET GIFT_FG  = '2',                                      
                                     UPDATE_RESI_NO = '7778889999000',                    
                                     UPDATE_DATE = TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'),  
                                     POS_NO = null                                        
                               WHERE HQ          = '${hq}'                                      
                                 AND STORE       = '${store}'                                      
                                 AND PERIOD      = '${period}'                                      
                                 AND cust_no     = '${attendCustNo}'                                      
                                 AND GIFT_CLASS  = 'C'                                      
                                 AND GIFT_FG     in('0', '9')                                                                                                                                      		   						  			 
	</update>
	<update id="upTrmstbCancel" parameterType="ak_web.model.web.LectureVo">
		   update BATRMSTB              
             set cancel_yn   ='Y',       
                 create_date = TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')  
            where hq       = '${hq}'                          
              and store    = '${store}'                          
              and period   = '${period}'                          
              and sale_ymd = '${sale_ymd}'                          
              and pos_no   = '${pos_no}'                          
              and recpt_no =  '${recpt_no}'                             		   						  			 
	</update>
	<update id="upPeretbCancel" parameterType="ak_web.model.web.LectureVo">
		  update BAPERETB                          
               set CANCEL_POS_NO = '070013'        ,         
                   CANCEL_YMD = TO_CHAR(SYSDATE, 'YYYYMMDD'),  
                   PAY_YN          = 'N',  
                   REGIS_CANCEL_FG = '2',  
                   FOOD_CANCEL_YN  = DECODE(FOOD_FEE,0,'N','Y'), 
                   UPDATE_RESI_NO  = '7778889990000', 
                   UPDATE_DATE     = TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS') 
             where hq       = '${hq}'                          
               and store    = '${store}'                          
               and period   = '${period}'                          
               and sale_ymd = '${sale_ymd}'                          
               and pos_no   = '${pos_no}'                          
               and recpt_no = '${recpt_no}'                         
	</update>
	<update id="upWbtrtbCancel" parameterType="ak_web.model.web.LectureVo">
		  update BAWBTRTB#              
             set cancel_yn = 'Y',         
                 update_date = TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')  
            where hq       = '${hq}'                          
              and store    = '${store}'                          
              and period   = '${period}'                          
              and cust_no  = '${custNo}'                          
              and sale_ymd = '${sale_ymd}'                          
              and send_recpt_no =  '${recpt_no}'                    
              and sale_fg  = '01'                        
              and cancel_yn = 'N'                        
              and POS_TYPE = DECODE('${pos_no}', '070013', 'W', 'M')  
	</update>
	<insert id="insWbtrtbCancel" parameterType="hashmap">
		 insert into                      
                 bawbtrtb(hq, store, sale_ymd , sale_time , cust_no , subject_cd , period ,enuri2_yn , tot_amt , enuri2_amt , card_amt  
                         ,card_no , inst_fg , inst_mm , valid_date , approve_no , pay_method,  mem_fg , van_fg , ip_address , free_yn , akmem_recpt_no, sms_yn 
                         ,sale_fg, ori_sale_ymd, ori_send_recpt_no, cancel_yn, pos_type, ori_pos_no , tid , point_amt )   
                  select   '${hq}',    '${store}',    '${sDate}',     '${sCurrentTime}',  cust_no , subject_cd , period ,enuri2_yn , tot_amt , enuri2_amt , card_amt  
                         ,card_no , inst_fg , inst_mm , valid_date,  approve_no, pay_method,  mem_fg , van_fg , '${ipAddress}' , free_yn , '${akmem_recpt_no}', 'N' 
                         ,'02', '${sale_ymd}', '${recpt_no}', 'N', 'W' , '${pos_no}' , '${tid}' , point_amt 
                 from bawbtrtb   
                where hq       = '${hq}'                          
                  and store    = '${store}'                          
                  and period   = '${period}'                          
                  and cust_no  = ${custNo}                          
                  and sale_ymd = '${sale_ymd}'                          
                  and send_recpt_no =  '${recpt_no}'                    
                  and sale_fg  = '01'                        
                  and pos_type  = decode('${pos_no}', '070014', 'M', 'W')  
	</insert>
	<insert id="insWbptTbCancel" parameterType="hashmap">
                                
		     INSERT INTO bawbpttb                     
                                        (hq, STORE, sale_ymd, pos_no, akmem_recpt_no,    
                                         ssat_tot_amt, card_amt, card_no, akmem_custno,  
                                         akmem_family_custno, akmem_recpt_point, akmem_approve_no,  
                                         akmem_send_buff_new, akmem_recv_buff_new , akmem_tot_point, slip_cnt, card_seq_no , AKMEM_USE_POINT  
                                       )                                     
                                   SELECT hq, STORE, '${sDate}', pos_no , '${akmem_recpt_no}',          
                                          ssat_tot_amt, card_amt, card_no, akmem_custno,  
                                          akmem_family_custno, akmem_recpt_point, '${AKmem_SaveApproveNo_POS}',  
                                          '${AKmem_send_buff}',                                 
                                          '${AKmem_recv_buff}',                                 
                                          '${AKmem_SaveApprove_Point}',slip_cnt, card_seq_no  , AKMEM_USE_POINT          
                                     FROM bawbpttb                          
                                    WHERE hq         = '${hq}'                    
                                      AND store      = '${store}'                    
                                      AND sale_ymd   = '${sale_ymd}'                    
                                      AND pos_no     = '${pos_no}'                    
                                      AND RECPT_NO   = '${recpt_no}'                    
                                      AND card_seq_no   = '998'             
	</insert>
	<insert id="insWbptTbCancel2" parameterType="hashmap">
		         INSERT INTO bawbpttb                     
                                        (hq, STORE, sale_ymd, pos_no, akmem_recpt_no,    
                                         ssat_tot_amt, card_amt, card_no, akmem_custno,  
                                         akmem_family_custno, akmem_recpt_point, akmem_approve_no,  
                                         akmem_send_buff_new, akmem_recv_buff_new , akmem_tot_point, slip_cnt, card_seq_no  
                                       )                                     
                                   SELECT hq, STORE, '${sDate}', '070013' , '${akmem_recpt_no}',          
                                          ssat_tot_amt, card_amt, card_no, akmem_custno,  
                                          akmem_family_custno, akmem_recpt_point, '${AKmem_SaveApproveNo_POS}',  
                                          '${AKmem_send_buff}',                                 
                                          '${AKmem_recv_buff}',                                 
                                          '${AKmem_SaveApprove_Point}', slip_cnt, card_seq_no           
                                     FROM bawbpttb                          
                                    WHERE hq         = '${hq}'                    
                                      AND store      = '${store}'                       
                                      AND sale_ymd   = '${sale_ymd}'                    
                                      AND pos_no     = '${pos_no}'                      
                                      AND RECPT_NO   = '${recpt_no}'                    
                                      AND card_seq_no   = '999'                       
	</insert>
	<delete id="tempDeleteProcess" parameterType="ak_web.model.web.LectureVo">
		          DELETE FROM batemptb                             
             WHERE hq        = '${hq}'                              
            AND store     = '${store}'                                 
            AND cust_no   = '${attendCustNo}'                                 
            AND sessionid   = '${sessionId}'  
            and subject_cd in (${tot_subject_cd})                                                                                                                                                              		   						  			 
	</delete>
	<insert id="freeUseInsert" parameterType="hashmap">
		         INSERT INTO BAFREETB (																			
                 HQ, STORE, POS_NO, AKMEM_RECPT_NO, PERIOD, CUST_NO,							
                 SEQ, FREE_FG, FREE_AMT, PAY_YN,																
                 FREE_YMD, CREATE_RESI_NO, CREATE_DATE, SUBJECT_CD)								
                 VALUES (																									
                 '${hq}', '${store}', '070013', '${akmem_recpt_no}', '${period}', '${attendCustNo}',																					          
                 (SELECT NVL(MAX(SEQ), 0) + 1 FROM BAFREETB WHERE HQ= '${hq}' AND STORE='${store}' AND PERIOD ='${period}' AND cust_no='${attendCustNo}'), 
                 DECODE('${intFreeUse}','5000','5','10000','1','9') , '${intFreeUse}',  'Y', TO_CHAR(SYSDATE,'YYYYMMDD'), 		
                 '7777888899990', TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS'), '${subject_cd}' ) 						
      																                                                                                                          		   						  			 
	</insert>
	<insert id="insMail" parameterType="hashmap">
		          insert into BAMAILTB (    
                     AUTOMAIL_ID, 
                     SEND_NM,     
                     SEND_EMAIL,  
                     CUST_NM,     
                     EMAIL,       
                     TITLE,       
                     TEMPLATE,    
                     SEND_YN,     
                     TYPE,        
                     STORE,       
                     SALE_YMD,    
                     SALE_TIME,   
                     CUST_NO,     
                     PTL_ID,      
                     CMPNCODE,    
                     CREATE_DATE, 
                     REPLYTO      
                )                 
                 select '${automail_id}',         --  일련번호                                                                                                                                    
                       'AK플라자 문화아카데미',   -- 보내는사람이름                                                                                                     
                       'webmaster@akmembers.com', -- 보내는사람이메일주소                                                                                       
                        b.kor_nm,  -- 받는사람이름                                                                                                                              
                        '${sendEmail}',  -- 받는사람이메일         
                        decode(a.sale_fg,'01','[AK플라자 문화아카데미] '||b.kor_nm||' 회원님께서 수강 결제하신 내역입니다.',    
                                         '02','[AK플라자 문화아카데미] '||b.kor_nm||' 회원님께서 수강 취소하신 내역입니다.',''), -- 이메일제목  
                        '${emailUrl}', -- 이메일템플릿URL                                                                     
                        'N',  -- 발송여부                                                                                                                                                
                        decode(a.sale_fg,'01','A','02','B',''),  -- 메일타입 결제:A, 취소:B                        
                        a.store,  -- 지점                                                                                                                                              
                        a.sale_ymd,  -- 결제일자                                                                                                                                  
                        a.sale_time,  -- 결제시간                                                                                                                                
                        a.CUST_NO,  -- 문화아카데미 회원번호                                                                                                               
                        '${user_id}',  -- 고객아이디                                                                                                                                                
                        0,   -- 캠페인코드                                                                                                                                              
                        sysdate,      -- 생성일자                                                                                                                               
                        'webmaster@akmembers.com'  -- 회신받을이메일                                                                                            
                  from bawbtrtb a, bacusttb b                                                                  
                 where a.hq = b.hq                                                                             
                   and a.store = b.store                                                                       
                   and a.cust_no = b.cust_no                                                                   
                   and a.hq = '${hq}'                                                                                
                   and a.store= '${store}'                                                                              
                   and a.period = '${period}'                                                                            
                   and a.cust_no ='${attendCustNo}'                                                                            
                   and a.sale_ymd ='${sale_ymd}'                                                                           
                   and a.sale_time = '${sale_time}'                                                                         
                   and a.sale_fg ='01'                                                                         
                    and rownum <![CDATA[<]]> 2                                                                             
                
      																                                                                                                          		   						  			 
	</insert>
	<insert id="insGiftRet2" parameterType="hashmap">
		          INSERT INTO BAGIFTTB                                                             
                                         (HQ, STORE, PERIOD, GIFT_CLASS,                                       
                                          CUST_NO, CUST_FG, GIFT_SEQ,                                          
                                          GIFT_FG, GIFT_DATE,                                                  
                                          CREATE_RESI_NO, CREATE_DATE, GUBUN )                                 
                                   VALUES ('${hq}', '${store}', '${period}', 'C',                                                         
                                           '${attendCustNo}',   '3',     (SELECT NVL(MAX(GIFT_SEQ), 0) + 1 FROM BAGIFTTB       
                                                           WHERE HQ         = '${hq}'                                
                                                             AND STORE      = '${store}'                                
                                                             AND PERIOD     = '${period}'                                
                                                             AND GIFT_CLASS = 'C'                                
                                                             AND cust_no    = '${attendCustNo}'),                              
                                           '2', TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'),                          
                                          '7778889999000', TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'), 'W')          																                                                                                                          		   						  			 
	</insert>
	<insert id="insWbptTb" parameterType="hashmap">
		              INSERT INTO bawbpttb     
                                (hq, STORE, sale_ymd, pos_no, akmem_recpt_no,   
                                 ssat_tot_amt, card_amt, card_no, akmem_custno, akmem_family_custno,  
                                 akmem_recpt_point, akmem_approve_no, akmem_send_buff, akmem_recv_buff, akmem_tot_point,  
                                 akmem_use_point , VAT_CAL_USE_PT, VAT_CAL_EXT_USE_PT, akmem_send_buff_new, akmem_recv_buff_new,   
                                 slip_cnt, card_seq_no   
                               )  
                           VALUES ('${hq}' , '${store}' , '${sDate}' , '${pos_no}' , '${akmem_recpt_no}' ,
                        		                '${dTotalAmt}' , '${dTotalAmt}' , '${AKmem_CardNo}' , '${AKmem_CustNo}' , '' ,
                        		                '0' , '${AKmem_SaveApproveNo_POS}' , ' ' , ' ' , '${AKmem_SaveApprove_Point}' ,
                        		                '${USE_PT}' , '${VAT_CAL_USE_PT}' , '${VAT_CAL_EXT_USE_PT}' , '${AKmem_send_buff}' , '${AKmem_recv_buff}' ,
                        		                '${slip_cnt}' , '998' )															                                                                                                          		   						  			 
	</insert>
	<insert id="insWbptTb2" parameterType="hashmap">
		                INSERT INTO bawbpttb     
                                (hq, STORE, sale_ymd, pos_no, akmem_recpt_no,   
                                 ssat_tot_amt, card_amt, card_no, akmem_custno, akmem_family_custno, 
                                 akmem_recpt_point, akmem_approve_no, akmem_send_buff, akmem_recv_buff, akmem_tot_point, 
                                 akmem_use_point , VAT_CAL_USE_PT, VAT_CAL_EXT_USE_PT, akmem_send_buff_new, akmem_recv_buff_new, 
                                 slip_cnt, card_seq_no  
                               )  
                           VALUES ('${hq}' , '${store}' , '${sDate}' , '${pos_no}' , '${akmem_recpt_no}' ,
                        		                '${dTotalAmt}' , '${dTotalAmt}' , '${AKmem_CardNo}' , '${AKmem_CustNo}' , '' ,
                        		                '${AKmem_Create_Point}' , '${AKmem_SaveApproveNo_POS}' , ' ' , ' ' , '${AKmem_SaveApprove_Point}' ,
                        		                '0' , '0' , '0' , '${AKmem_send_buff}' , '${AKmem_recv_buff}' ,
                        		                '${slip_cnt}' ,'999' ) 												                                                                                                          		   						  			 
	</insert>
	<insert id="insWbtrTb" parameterType="hashmap">
		  insert into                      
         bawbtrtb(hq, store, sale_ymd , sale_time , akmem_recpt_no, cust_no , subject_cd , period ,enuri1_yn, enuri2_yn , tot_amt , enuri1_amt, enuri2_amt , enuri1_code, enuri2_code, card_amt  
         ,card_no , inst_fg , inst_mm , valid_date , approve_no , mem_fg , van_fg , ip_address , free_yn ,pay_method, sms_yn, sale_fg, cancel_yn, enuri_code, tid, point_amt, child_no, child_no1  )  
         select '${hq}', '${store}', '${sDate}' , '${sCurrentTime}' , '${akmem_recpt_no}' , a.cust_no , a.subject_cd , '${period}', '${enuri1_yn}', '${enuri2_yn}', '${dTotAmt}'
         , '${enuri1_amt}', '${enuri2_amt}', '${enuri1_code}', '${enuri2_code}', '${dTotalAmt}'                             
         , '${sCardNo}' , '${sInstFg}' , '${sAllot}' , '${sValidDt}' , '${sApprovNo}' , '${scBank_cd}' , '${scRate}', a.cust_ip , decode(b.regis_fee, 0, 'Y', 'N'), '${cardfg}' ,'N' ,'01' , 'N' , '${strECode}', '${tid}', '${uPointAmt}', a.c_cust1, a.c_cust2 
         from batemptb a, BAPELTTB b                         
         where a.hq        = b.hq                            
         and a.store      = b.store                          
         and a.subject_cd = b.subject_cd  
         and a.subject_cd = '${subject_cd}'                   
         and a.cust_no    = ${attendCustNo}                            
         and a.sessionid  = '${sessionId}'                            
         and b.period     = '${period}'                            
         and b.hq         = '${hq}'                            
         and b.store      = '${store}'                               																                                                                                                          		   						  			 
	</insert>
	<insert id="insWbtrTb_half" parameterType="hashmap">
		     INSERT INTO bawbtrtb (
        hq,
        store,
        sale_ymd,
        sale_time,
        akmem_recpt_no,
        cust_no,
        subject_cd,
        period,
        enuri2_yn,
        tot_amt,
        enuri2_amt,
        card_amt,
        card_no,
        inst_fg,
        inst_mm,
        valid_date,
        approve_no,
        mem_fg,
        van_fg,
        ip_address,
        free_yn,
        pay_method,
        sms_yn,
        sale_fg,
        cancel_yn,
        enuri_code,
        tid,
        point_amt
    )
        SELECT
            '${hq}',
            '${store}',
            '${sDate}',
            '${sCurrentTime}',
            '${akmem_recpt_no}',
            '${attendCustNo}',
            subject_cd,
            '${period}',
            CASE
                WHEN ( nvl(enuri_percent, 0) = 0 ) THEN
                    'N'
                ELSE
                    '2'
            END enuri2_yn,
            '${dTotAmt}',
            CASE
                WHEN ( nvl(enuri_percent, 0) = 0 ) THEN
                    0
                ELSE
                    ( nvl(regis_fee, 0) * nvl(enuri_percent, 0) / 100 )
            END enuri2_amt,
            '${dTotalAmt}',
            '${sCardNo}',
            '${sInstFg}',
            '${sAllot}',
            '${sValidDt}',
            '${sApprovNo}',
            '${scBank_cd}',
            '${scRate}',
            '${ipAddress}',
            decode(regis_fee, 0, 'Y', 'N'),
            '${cardfg}',
            'N',
            '01',
            'N',
            '${strECode}',
            '${tid}',
            '${uPointAmt}'
        FROM
            bapelttb
        WHERE
            period = '${period}'
            AND hq = '${hq}'
            AND store = '${store}'
            AND subject_cd in (${tot_subject_cd})                            																                                                                                                          		   						  			 
	</insert>
	<!-- 
	<select id="getBookList" parameterType="hashmap" resultType="hashmap">
		select
			X.*
			from ( 
			    select rownum as rnum, A.*
			    from ( 
			    select
			       (select short_name from bacodetb where CODE_FG = '02' and sub_code = bapelttb.store) as store_nm,
			       bapelttb.subject_cd,
			       bapelttb.subject_nm,
			       bapelttb.web_lecturer_nm,
			       SUBSTR(bapelttb.lect_hour,1,2)||':'||SUBSTR(bapelttb.lect_hour,3,2) as start_hour,
			       SUBSTR(bapelttb.lect_hour,5,2)||':'||SUBSTR(bapelttb.lect_hour,7,2) as end_hour,
			       TO_CHAR(TO_DATE(bapelttb.start_ymd, 'YYYYMMDDHH'), 'YYYY.MM.DD') as start_ymd,
			       TO_CHAR(TO_DATE(bapelttb.end_ymd, 'YYYYMMDDHH'), 'YYYY.MM.DD') as end_ymd,
			       bapelttb.regis_fee,
			       nvl(bapelttb.food_amt,'0') as food_amt,
			       
			       case when TO_CHAR(SYSDATE, 'YYYYMMDD') <![CDATA[>=]]> TO_CHAR(TO_DATE(bapelttb.end_ymd, 'YYYYMMDDHH'), 'YYYYMMDD') then '마감'
			           when TO_CHAR(SYSDATE, 'YYYYMMDD') <![CDATA[>=]]> TO_CHAR(TO_DATE(bapelttb.end_ymd, 'YYYYMMDDHH')-3, 'YYYYMMDD') then '마감임박'
			           else '접수중' end as lect_state,
			           
			       case when end_yn = 'Y' then '폐강'
			       	 when start_ymd <![CDATA[<=]]> TO_CHAR(SYSDATE, 'YYYYMMDD') and end_ymd <![CDATA[>=]]> TO_CHAR(SYSDATE, 'YYYYMMDD') then '진행'
			            when start_ymd <![CDATA[>=]]> TO_CHAR(SYSDATE, 'YYYYMMDD') and end_ymd <![CDATA[>=]]> TO_CHAR(SYSDATE, 'YYYYMMDD') then '준비'
			            else '종료' end as ISPLAY,
		           babook_shelftb.store,
		           babook_shelftb.period
			           
			     from babook_shelftb,bapelttb where 1=1
			          and babook_shelftb.cust_no = '${cust_no}'
			          and bapelttb.subject_cd = babook_shelftb.subject_cd
			          and babook_shelftb.use_yn ='Y'
			    ) A
			    where rownum <![CDATA[<=]]> #{e_rownum}) X
			where X.rnum <![CDATA[>]]> #{s_rownum}
			<if test="!order_by.equals('') and !sort_type.equals('')">
		   		order by ${sort_type} ${order_by}
		   	</if>
	</select>
	 -->
	<select id="getBookCount" parameterType="hashmap" resultType="hashmap">
				SELECT  COUNT(*) AS CNT 			
				             FROM BAPELTTB# A, BAWAITTB B, BALECRTB# C																			
				            WHERE A.HQ      = 00																												
				            AND A.STORE   = '${store}'																													
				            AND A.PERIOD  = '${period}'																													
				            AND B.HQ(+) = A.HQ																													
				            AND B.STORE(+) = A.STORE																										
				            AND B.PERIOD(+) = A.PERIOD																										
				            AND B.SUBJECT_CD(+) = A.SUBJECT_CD																						
				            AND B.DELETE_FG(+) = '1'																											
				            AND A.LECTURER_CD  = C.LECTURER_CD																						
				            AND EXISTS ( SELECT SUBJECT_CD               																				
				            					FROM BATEMPTB                                																	
				            					WHERE HQ         = 00                         																	
				            					AND STORE      = '${store}'                           																	
				            					AND cust_no    = '${cust_no}'                           																	
				            					AND SESSIONID    = '${cust_id}'                     						    											
				            					AND HQ         = A.HQ                        																	
				            					AND STORE      = A.STORE                     																
				            					AND SUBJECT_CD = A.SUBJECT_CD )              															
	</select>
	<select id="getNewsCount" parameterType="hashmap" resultType="hashmap">
		SELECT  COUNT(*) AS CNT 			
           FROM banewstb_mu
		where hq = '00'
		and is_show = 'Y' and start_ymd <![CDATA[<=]]> TO_CHAR(SYSDATE, 'YYYYMMDD') and end_ymd <![CDATA[>=]]> TO_CHAR(SYSDATE, 'YYYYMMDD')
		<if test="!search_store.equals('')">
			and (store = '${search_store}' or store = '00')
		</if>
		<if test="!search_name.equals('')">
			<if test="search_type eq 'title'.toString()">
				and title = '${search_name}'
			</if>
			<if test="search_type eq 'contents'.toString()">
				and contents = '${search_name}'
			</if>
		</if>
	</select>
	<select id="getPlanListCount" parameterType="hashmap" resultType="hashmap">
		SELECT  COUNT(*) AS CNT 			
           FROM bapelttb
		where hq = '00'
		and store = '${search_store}'
		and (cus_no = '${login_cus}' or cus_no1 = '${login_cus}')
		<if test="!start_peri.equals('')">
    		and period <![CDATA[>=]]> '${start_peri}' 
	   	</if>
	   	<if test="!end_peri.equals('')">
	    	and period <![CDATA[<=]]> '${end_peri}' 
	   	</if>
	   	
	</select>
	
	
	 <select id="getBookList" parameterType="hashmap" resultType="hashmap">
	 
	select
		X.*
		from ( 
		    select rownum as rnum, A.*
		    from ( 
		    	select
				pelt.*,
				batemptb.cust_no,
				batemptb.p_cust,
				batemptb.c_cust1,
				batemptb.c_cust2,
				(select kor_nm from bacusttb where cust_no = batemptb.p_cust) as p_nm,
				(select child_nm from bachildtb_mu where cust_no = batemptb.cust_no and child_no = batemptb.c_cust1) as c_nm1,
				(select child_nm from bachildtb_mu where cust_no = batemptb.cust_no and child_no = batemptb.c_cust2) as c_nm2
				from 
				batemptb,
				(
					SELECT A.HQ, A.SUBJECT_CD				
								,A.STORE
								,A.PERIOD
								,(select short_name from bacodetb where CODE_FG = '02' and sub_code = A.STORE) as store_nm																						
					            ,A.START_YMD																														
					            ,A.END_YMD																															
					            ,UPPER(A.SUBJECT_NM) SUBJECT_NM																							
					            ,(CASE WHEN SUBSTR(A.DAY_FLAG, 1, 1) = '1' THEN '월' ELSE '' END)||												
					            (CASE WHEN SUBSTR(A.DAY_FLAG, 2, 1) = '1' THEN '화' ELSE '' END)||												
					            (CASE WHEN SUBSTR(A.DAY_FLAG, 3, 1) = '1' THEN '수' ELSE '' END)||												
					            (CASE WHEN SUBSTR(A.DAY_FLAG, 4, 1) = '1' THEN '목' ELSE '' END)||												
					            (CASE WHEN SUBSTR(A.DAY_FLAG, 5, 1) = '1' THEN '금' ELSE '' END)||												
					            (CASE WHEN SUBSTR(A.DAY_FLAG, 6, 1) = '1' THEN '토' ELSE '' END)||												
					            (CASE WHEN SUBSTR(A.DAY_FLAG, 7, 1) = '1' THEN '일' ELSE '' END)||												
					            ' ('||SUBSTR(A.LECT_HOUR,1,2)||':'||SUBSTR(A.LECT_HOUR,3,2)||'~'||												
					            SUBSTR(A.LECT_HOUR,5,2)||':'||SUBSTR(A.LECT_HOUR,7,2)||')' LECT_HOUR										
					            ,A.REGIS_FEE																															
					            ,NVL(A.FOOD_AMT,0) FOOD_AMT																								
					            ,A.FOOD_YN				                  																							
					            ,NVL(TRIM(A.WEB_LECTURER_NM),' ') LECTURER_NM       						   	
					           <!--   //,A.CAPACITY_NO - (NVL(A.WEB_REGIS_NO,0) + NVL(A.REGIS_NO,0)) POSSIBLE_NO                	 //접수현황-->
					            ,A.CAPACITY_NO - (NVL(A.WEB_REGIS_NO,0) + NVL(A.REGIS_NO,0)+(COUNT(B.CUST_NO))) POSSIBLE_NO 	 <!--//대기자 추가-->
					            ,A.MAIN_CD,A.SECT_CD, TRIM(BA_SECT_NM(A.HQ, A.STORE, A.MAIN_CD, A.SECT_CD)) SECT_NM 			
					  FROM BAPELTTB# A, BAWAITTB B
					            WHERE A.HQ      = 00																												
					            AND A.STORE   = '${store}'																													
					            AND A.PERIOD  = '${period}'																													
					            AND B.HQ(+) = A.HQ																													
					            AND B.STORE(+) = A.STORE																										
					            AND B.PERIOD(+) = A.PERIOD																										
					            AND B.SUBJECT_CD(+) = A.SUBJECT_CD																						
					            AND B.DELETE_FG(+) = '1'																											
<!-- 					            AND EXISTS ( SELECT SUBJECT_CD               																				 -->
<!-- 					            					FROM BATEMPTB                                																	 -->
<!-- 					            					WHERE HQ         = 00                         																	 -->
<!-- 					            					AND STORE      = '${store}'                           																	 -->
<!-- 					            					AND cust_no    = '${cust_no}'                           																	 -->
<!-- 					            					AND SESSIONID    = '${cust_id}'                     						    											 -->
<!-- 					            					AND HQ         = A.HQ                        																	 -->
<!-- 					            					AND STORE      = A.STORE                     																 -->
<!-- 					            					AND SUBJECT_CD = A.SUBJECT_CD )              															 -->
					            GROUP BY A.SUBJECT_CD,A.PERIOD, A.START_YMD, A.END_YMD, A.SUBJECT_NM,A.DAY_FLAG								
					            ,A.LECT_HOUR,A.REGIS_FEE, A.FOOD_AMT, A.FOOD_YN, A.WEB_LECTURER_NM
					            ,A.CAPACITY_NO, A.REGIS_NO, A.WEB_REGIS_NO, A.MAIN_CD, A.SECT_CD,A.HQ, A.STORE					
	 			) pelt
	 			where
				batemptb.hq = 00
				AND batemptb.store = '${store}'
				AND batemptb.cust_no = '${cust_no}'
				AND batemptb.sessionid = '${cust_id}'
				AND batemptb.hq = pelt.hq
				AND batemptb.store = pelt.store
				AND batemptb.subject_cd = pelt.subject_cd
		    ) A
		    where rownum <![CDATA[<=]]> #{e_rownum}) X
		where X.rnum <![CDATA[>]]> #{s_rownum}
		
		<if test="!order_by.equals('') and !sort_type.equals('')">
	   		order by ${sort_type} ${order_by}
	   	</if>
	 	
	 </select>
	 <select id="getNewsList" parameterType="hashmap" resultType="hashmap">
	 
		select
		X.*
		from ( 
		    select rownum as rnum, A.*
		    from ( 
		    	select
		    	banewstb_mu.*,
		    	nvl((select short_name from bacodetb where CODE_FG = '02' and sub_code = banewstb_mu.store), '전점') as store_nm
		    	from banewstb_mu
		    	where hq = '00'
		    	and is_show = 'Y' and start_ymd <![CDATA[<=]]> TO_CHAR(SYSDATE, 'YYYYMMDD') and end_ymd <![CDATA[>=]]> TO_CHAR(SYSDATE, 'YYYYMMDD') 
				<if test="!search_store.equals('')">
					and (store = '${search_store}' or store = '00')
				</if>
				<if test="!search_name.equals('')">
					<if test="search_type eq 'title'.toString()">
						and LOWER(title) = LOWER('${search_name}')
					</if>
					<if test="search_type eq 'contents'.toString()">
						and LOWER(contents) = LOWER('${search_name}')
					</if>
				</if>
		    
	 			order by sort
		    ) A
		    where rownum <![CDATA[<=]]> #{e_rownum}) X
		where X.rnum <![CDATA[>]]> #{s_rownum}
		
	 	
	 </select>
	 <select id="getPlanList" parameterType="hashmap" resultType="hashmap">
	 
		select
		X.*
		from ( 
		    select rownum as rnum, A.*
		    from ( 
		    	
		    	SELECT
		    	(select web_text from baperitb where store = bapelttb.store and period = bapelttb.period) as web_text,
		    	(select short_name from bacodetb where CODE_FG = '02' and sub_code = bapelttb.store) as store_nm,
		    	decode(bapelttb.SUBJECT_FG, '1', '정규', '2', '단기', '3', '특강') as SUBJECT_FG_NM	,																					
		    	bapelttb.*
		    	FROM bapelttb
				where hq = '00'
				and store = '${search_store}'
				and (cus_no = '${login_cus}' or cus_no1 = '${login_cus}')
				<if test="!start_peri.equals('')">
		    		and period <![CDATA[>=]]> '${start_peri}' 
			   	</if>
			   	<if test="!end_peri.equals('')">
			    	and period <![CDATA[<=]]> '${end_peri}' 
			   	</if>
		    	
		    	
		    	
		    ) A
		    where rownum <![CDATA[<=]]> #{e_rownum}) X
		where X.rnum <![CDATA[>]]> #{s_rownum}
		
	 	
	 </select>
	 
	 
	<delete id="del_bookshelf" parameterType="hashmap">
            delete from batemptb                              
            where hq          = 00                             
            and store       = '${store}'                            
            and cust_no    = '${cust_no}'                        
            and subject_cd = '${subject_cd}'               
           <if test="ischk.equals('1')">
            and pay_date is not null 
            </if>
	</delete>
	
	<select id="getTempPayDateSet" parameterType="ak_web.model.web.LectureVo" resultType="hashmap">
		    SELECT NVL(CAPACITY_NO,0) CAPACITY_NO,	
            NVL(REGIS_NO,0) + NVL(WEB_REGIS_NO,0) +   	
             (SELECT COUNT(CUST_NO) FROM BAWAITTB   
               WHERE HQ =F.HQ   									
                AND STORE =F.STORE   							
                AND PERIOD = F.PERIOD   							
                AND SUBJECT_CD =F.SUBJECT_CD   			
                AND DELETE_FG ='1' ) REGIS_NO  				
            FROM BAPELTTB  F                              	    	
            WHERE HQ         		= '${hq}'                            	
            AND STORE      		= '${store}'                               	
            AND PERIOD     		= '${period}'                               	
            AND SUBJECT_CD 	= '${subject_cd}'                               	
            FOR UPDATE OF WEB_REGIS_NO                     
	</select>
	
	<update id="upt_regi_no" parameterType="hashmap">
            update BAPELTTB   
            set web_regis_no = nvl(web_regis_no,0) - #{cnt}
            where hq         = 00
            and store      = '${store}'
            and period     = '${period}'
            and subject_cd = '${subject_cd}'
                       
	</update>
	
	
	<update id="tempPayDateSet1" parameterType="ak_web.model.web.LectureVo">
		update batemptb      SET pay_date = TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')                
        where hq          = '00'                             
        and store       = '${store}'                               
        and cust_no    = '${attendCustNo}'                                
        and sessionid = '${sessionId}'                                
        and subject_cd = '${subject_cd}'                            
        and pay_date is  null                              
	</update>
	<update id="tempPayDateSet2" parameterType="hashmap">
		 update BAPELTTB                               
         set web_regis_no = nvl(web_regis_no,0) + ${cnt}    
         where hq         = '00'                          
         and store      = '${store}'                            
         and period     = '${period}'                            
         and subject_cd = '${subject_cd}'                            
	</update>
	
	<select id="getchildCount" parameterType="hashmap" resultType="hashmap">
	    select
	       count(*) as cnt
	           
	     from bachildtb_mu where 1=1
	     	and use_yn = 'Y'
	     	and cust_no = '${cust_no}'
	</select>
	
	<select id="selectLectSin" parameterType="ak_web.model.web.LectureVo" resultType="int">
		SELECT nvl(count(*),0) cnt        
		FROM bagiftmtb                   
		WHERE hq     = '00'                 
		AND store     = '${store}'                 
		AND period    = '${period}'                  
		AND to_char(sysdate,'yyyymmdd')    between trim(gift_fdate) and trim(gift_tdate)  
	</select>
	<select id="retrieveTempCheck" parameterType="ak_web.model.web.LectureVo" resultType="int">
		SELECT nvl(count(*),0) cnt                       
             FROM batemptb                                   
             WHERE hq        = '00'                             
            AND store     = '${store}'                                
            AND trim(cust_no)   = trim('${attendCustNo}')                              
            AND sessionid   = '${sessionId}'       
            and subject_cd in (${tot_subject_cd})                       
	</select>
	<select id="retrieveSettleCheck" parameterType="ak_web.model.web.LectureVo" resultType="hashmap">
		select subject_cd                                
             from BAPERETB                                   
             where hq       = '00' and store = '${store}'                
               and period   = '${period}'                              
               and cust_no  = '${attendCustNo}'                              
               and regis_cancel_fg = '1'                     
               and subject_cd in ( select a.subject_cd       
                                   from batemptb a           
                                  where a.hq        = '${hq}'      
                                    and a.store     = '${store}'      
                                    and a.cust_no   = '${attendCustNo}'      
                                    and a.sessionid = '${sessionId}'
                                    and a.subject_cd in (${tot_subject_cd}) 
                                    )    
            union                                            
            select subject_cd                                
             from bawbtrtb                                   
            where period  = '${period}'                                
              and cust_no = '${attendCustNo}'                                
              and send_yn = 'N'                              
              and subject_cd in ( select a.subject_cd  from batemptb a       
                                   where a.hq        = '${hq}'                     
                                    and a.store     = '${store}'                      
                                    and a.cust_no   = '${attendCustNo}'                      
                                    and a.sessionid = '${sessionId}'
                                    and a.subject_cd in (${tot_subject_cd})  
                                    )                    
                                    and hq = '00' and store = '${store}'                                             
	</select>
	
	<select id="getchild" parameterType="hashmap" resultType="hashmap">
		select
			X.*
			from ( 
			    select rownum as rnum, A.*
			    from ( 
			    
			   		select * from bachildtb_mu where 1=1
			   			and use_yn ='Y' 
			   			and cust_no = '${cust_no}'
			          
			    ) A
			    where rownum <![CDATA[<=]]> #{e_rownum}) X
			where X.rnum <![CDATA[>]]> #{s_rownum}
			
		   		order by birth,create_date
		   	
	</select>
	
	<select id="getmyinfo" parameterType="hashmap" resultType="hashmap">
		select  
		    kor_nm,
		    to_char(to_date(birth_ymd,'YYYYMMDD'),'YYYY-MM-DD') as birth_ymd,
		    trim(phone_no1)||'-'||trim(phone_no2)||'-'||trim(phone_no3) as phone_no,
		    cust_no as cust_no
		from bacusttb where cust_no = '${cust_no}'
	</select>
	
	<insert id="saveChild" parameterType="hashmap">
		<selectKey keyProperty="child_no" order="BEFORE" resultType="int">
			select nvl(max(to_number(child_no))+1,1) as child_no from BACHILDTB_MU where cust_no='${cust_no}'
		</selectKey>
	
		insert into BACHILDTB_MU
		(CUST_NO, CHILD_NO, BIRTH, CHILD_NM, CREATE_RESI_NO, CREATE_DATE,GENDER)
		VALUES
		('${cust_no}', '${child_no}', '${child_birth}', '${child_nm}', '${login_seq}', TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'),'${child_gender}')
	</insert>
	
	<select id="getencdCount" parameterType="hashmap" resultType="hashmap">
		select 
		    count(*) as cnt
		from baencdtb_mu,baencdmtb_mu where 1=1
		    and baencdtb_mu.cust_no = '${cust_no}'
		    and baencdmtb_mu.enuri_cd = baencdtb_mu.enuri_cd
		    and baencdtb_mu.store = '${store}'
		    and baencdtb_mu.period=(select get_web_period('${store}') period from dual) --현재 기수에 지급된 할인코드만 검색
	</select>
	
	<select id="getencd" parameterType="hashmap" resultType="hashmap">
		select
			X.*
			from ( 
			    select rownum as rnum, A.*
			    from ( 
			    	    
				    select      
					    (select short_name from bacodetb where code_fg =02 and sub_code = baencdtb_mu.store) as store_nm, 
					    baencdtb_mu.*,          
					    baencdmtb_mu.enuri_fg,
					    baencdmtb_mu.enuri,
					    baencdmtb_mu.enuri_nm,
					    baencdmtb_mu.limited_amt,
					    baencdmtb_mu.discount_period_start,
					    baencdmtb_mu.discount_period_end
				    from baencdtb_mu,baencdmtb_mu where 1=1      
					    and baencdtb_mu.cust_no = '${cust_no}'        
					    and baencdmtb_mu.enuri_cd = baencdtb_mu.enuri_cd       
					    and baencdtb_mu.store = '${store}'
					    and baencdtb_mu.period=(select get_web_period('${store}') period from dual) --현재 기수에 지급된 할인코드만 검색
			    ) A
			    where rownum <![CDATA[<=]]> #{e_rownum}) X
			where X.rnum <![CDATA[>]]> #{s_rownum}
		   	
	</select>
	
	<select id="getwaitCount" parameterType="hashmap" resultType="hashmap">
	    select
	       count(*) as cnt
        from  bawaittb a , bapelttb b                                                     	
        where a.hq    = b.hq                                                              	
          and a.store  = b.store                                                          	
          and a.period = b.period                                                         	
          and a.subject_cd = b.subject_cd                                                 	
                                           		 			
          and a.store  = '${store}'                                                     			 		 
          and a.period = 002                                       							 	
          and a.cust_no = '${cust_no}'    
	</select>
	
	<select id="getwait" parameterType="hashmap" resultType="hashmap">
		select
			X.*
			from ( 
			    select rownum as rnum, A.*
			    from ( 
			    

				            select
				              (select short_name from bacodetb where code_fg =02 and sub_code = a.store) as store_nm,   
				              a.store,                                                                       
			            	  a.period,                                                          		     	 
			            	  to_char(to_date(a.create_date,'YYYYMMDD'),'YYYY.MM.DD') as regi_date ,                                      				 		   
			            	  a.subject_cd as subject_cd,                                       				 
			               	  UPPER(B.SUBJECT_NM) as subject_nm,                                  			 	
			               	  a.cust_no as cust_no ,                                              			
			               	  decode(a.delete_fg , '1' , '대기','2','등록','3','취소') as state_nm , 		 		
			               	  b.web_lecturer_nm,                                                    		 		 
			                  b.lect_hour,   
			                                                                      			
			                  to_char(to_date(b.start_ymd,'YYYYMMDD'),'YYYY.MM.DD') as start_ymd ,     
			                  to_char(to_date(b.end_ymd,'YYYYMMDD'),'YYYY.MM.DD') as end_ymd ,  
			                    
			                  b.day_flag,          	
			                  b.food_yn,                                                                     	
			                  b.regis_fee,                                                                   	
			                  b.food_amt                                                                       	
			               from  bawaittb a , bapelttb b                                                     	
			               where a.hq    = b.hq                                                              	
			                 and a.store  = b.store                                                          	
			                 and a.period = b.period                                                         	
			                 and a.subject_cd = b.subject_cd                                                 	
			                                                  		 			
			                 and a.store  = '${store}'                                                     			 		 
			                 and a.period = 002                                       							 	
			                 and a.cust_no = '${cust_no}'                                               				 
			            									 
			          
			    ) A
			    where rownum <![CDATA[<=]]> #{e_rownum}) X
			where X.rnum <![CDATA[>]]> #{s_rownum}
				order by state_nm, subject_cd , regi_date	
		   	
	</select>
	
	<delete id="del_wait" parameterType="hashmap">
		DELETE FROM BAWAITTB
		where 1=1
		and hq=00
		and	store='${store}'
		and subject_cd ='${subject_cd}'
		and cust_no ='${cust_no}'
	</delete>
	
	
<!-- 	<select id="getMylectureListCount" parameterType="hashmap" resultType="hashmap">  -->
          
<!-- 		SELECT COUNT(*) AS CNT                                                           -->
<!--          FROM ( SELECT A.HQ                                                                                                                                                                                                                                                               -->
<!--                       ,A.STORE                                                                                                                                                                                                                                                        -->
<!--                       ,A.PERIOD                                                                                                                                                                                                                                                       -->
<!--                       ,B.KOR_NM                                                                                                                                                                                                                                                       -->
<!--                       ,A.SUBJECT_CD                                                 -->
<!--                       ,A.PAY_YMD AS SALE_YMD                                 -->
<!--                       ,A.POS_NO                                              -->
<!--                       ,A.RECPT_NO                                            -->
<!--                       ,A.CUST_NO                                             -->
<!--                   FROM BAPERETB A                                                                                                                                                                                                                                                   -->
<!--                       ,BACUSTTB B                                                                                                                                                                                                                                         -->
                                                                                                                                                                                                                                     
<!--                  WHERE A.HQ = B.HQ                                                                                                                                                                                                                             -->
<!--                    AND A.STORE = B.STORE                                                                                                                                                                                                                       -->
<!--                    AND A.CUST_NO = '${cust_no}'                                                                                                                                                                                                                 -->
<!--                    AND A.HQ     = 00                                                                                                                                                                                                                              -->
<!--                    AND A.STORE  = '${store}'      -->
<!--                    <if test="!start_ymd.equals('')">                                                                                                                                                                                                                      -->
<!--                    		AND A.PERIOD <![CDATA[>=]]> ${start_ymd}   -->
<!--                    </if>     -->
<!--                     <if test="!end_ymd.equals('')">                                                                                                                                                                                                                      -->
<!--                    		AND A.PERIOD <![CDATA[<=]]> ${end_ymd}   -->
<!--                    </if>                                       -->
                                                                                                                                                                                        
<!--                    AND A.CUST_NO = B.CUST_NO                                                                                                                                -->
<!--                    AND A.regis_cancel_fg <![CDATA[<>]]> '3'                              -->
<!--                    AND A.RECPT_NO <![CDATA[<>]]> '*'                                     -->
<!--               )AA                                                                                                                                                                                                                      -->
<!--               ,BAPELTTB BB                                                                                                                                                                                                                                                       -->
<!--               ,BALECRTB CC                                                                                                                                                                                                                                                       -->
<!--          WHERE AA.HQ        = BB.HQ                                                                                                                                                                                                                                             -->
<!--            AND AA.STORE       = BB.STORE                                                                                                                                                                                                                                        -->
<!--            AND AA.PERIOD     = BB.PERIOD                                                                                                                                                                                                                                        -->
<!--            AND AA.SUBJECT_CD  = BB.SUBJECT_CD                                                                                                                                                                                                                                   -->
<!--            AND BB.LECTURER_CD = CC.LECTURER_CD                                                                                                                                                                                                                                   -->
<!--            AND BB.HQ          = 00                                                                                                                                                                                                                                                   -->
<!--            AND BB.STORE       = '${store}'    -->
<!-- 		   <if test="!start_ymd.equals('')">                                                                                                                                                                                                                      -->
<!--                 AND AA.PERIOD <![CDATA[>=]]> ${start_ymd}   -->
<!--            </if>     -->
<!--            <if test="!end_ymd.equals('')">                                                                                                                                                                                                                      -->
<!--           		AND AA.PERIOD <![CDATA[<=]]> ${end_ymd}   -->
<!--            </if> -->
<!-- 	</select> -->
	<select id="getPaymentListByTid" parameterType="hashmap" resultType="hashmap">
		SELECT 
                             AA.STORE
                               ,AA.PERIOD as GET_PERIOD
	                         ,NVL(AA.SUBJECT_CD, ' ')         SUBJECT_CD                                                                                                                                                                                                                                                                                                      
	                         ,UPPER(NVL(BB.SUBJECT_NM, ' '))  SUBJECT_NM                                                                                                                                                                                                                                                                                                     
	                         ,TRIM(BB.WEB_LECTURER_NM)        LECTURER_NM, BB.MAIN_CD                                                                                                                                                                                                                                                                                     
	                         ,(CASE WHEN SUBSTR(BB.DAY_FLAG, 1, 1) = '1' THEN '월' ELSE '' END)||                                                                                                                                                                                                                                                       
	                          (CASE WHEN SUBSTR(BB.DAY_FLAG, 2, 1) = '1' THEN '화' ELSE '' END)||                                                                                                                                                                                                                                                       
	                          (CASE WHEN SUBSTR(BB.DAY_FLAG, 3, 1) = '1' THEN '수' ELSE '' END)||                                                                                                                                                                                                                                                       
	                          (CASE WHEN SUBSTR(BB.DAY_FLAG, 4, 1) = '1' THEN '목' ELSE '' END)||                                                                                                                                                                                                                                                       
	                          (CASE WHEN SUBSTR(BB.DAY_FLAG, 5, 1) = '1' THEN '금' ELSE '' END)||                                                                                                                                                                                                                                                      
	                          (CASE WHEN SUBSTR(BB.DAY_FLAG, 6, 1) = '1' THEN '토' ELSE '' END)||                                                                                                                                                                                                                                                      
	                          (CASE WHEN SUBSTR(BB.DAY_FLAG, 7, 1) = '1' THEN '일' ELSE '' END)    AS DAY                                                                                                                                                                                                                                          
	                        ,'('||SUBSTR(LECT_HOUR,1,2)||':'||SUBSTR(LECT_HOUR,3,2)||'~'||SUBSTR(LECT_HOUR,5,2)||':'||SUBSTR(LECT_HOUR,7,2)||')' LECT_HOUR                                                                                                                                                                                             
	                        ,TO_CHAR(NVL(BB.REGIS_FEE    ,   0),'999,999') REGIS_FEE                                                                                                                                                                                                                                                                                              
                                     ,NVL(BB.ENURI_PERCENT,   0) ENURI_PERCENT                                                                                                                                                                                                                                                                                                                                                             
                                     ,DECODE(BB.FOOD_YN, 'R', '별도', 'N', '없음', TO_CHAR(NVL(BB.FOOD_AMT    ,   0),'999,999')) FOOD_AMT							   
                                     ,BB.PERIOD                                                                                                                      
                                     ,BB.START_YMD                                                                                                                      
                                     ,BB.END_YMD                                                                                                                      
                                     ,REPLACE((SELECT WEB_TEXT FROM BAPERITB WHERE HQ = 00 AND STORE = 03 AND PERIOD = BB.PERIOD),' ', '<![CDATA[<br/>]]>') AS WEB_TEXT            
                                     ,TO_CHAR(TO_DATE(AA.SALE_YMD, 'yyyymmdd'), 'YYYY') || '<![CDATA[<br/>]]>' || TO_CHAR(TO_DATE(AA.SALE_YMD, 'yyyymmdd'), 'MM/DD') AS PAY_YMD  
                                     ,AA.POS_NO                                                                                                                      
                                     ,AA.RECPT_NO                                                                                                                    
                                     ,AA.SALE_YMD                                                                                                                    
                                     ,cust_no as cust_no                                                                                                                        
                                     ,REGIS_CANCEL_FG                                                                                                                
                                     ,CANCEL_YMD                                                                                                                                     
                                     ,POS_TYPE                                                                                                                       
                                     ,DD.TID                                                                                                                         
                                     ,DECODE(DD.CARD_CORP_NO, '822', 'Y', 'N') AS AKCARD_YN                                                    
                                     ,DECODE(DD.CARD_CORP_NO, '042', 'Y', 'N') AS AKKBCARD_YN       
                                     ,DECODE(DD.CARD_CORP_NO, '034', 'Y', 'N') AS AKWBCARD_YN                                           
	                     FROM ( SELECT A.HQ                                                                                                                                                                                                                                                                                                                              
	                                  ,A.STORE                                                                                                                                                                                                                                                                                                                       
	                                  ,A.PERIOD                                                                                                                                                                                                                                                                                                                      
	                                  ,B.KOR_NM                                                                                                                                                                                                                                                                                                                      
	                                  ,A.SUBJECT_CD                                                                                                                
	                                  ,A.PAY_YMD AS SALE_YMD                                                                                                
                                               ,A.POS_NO                                                                                                             
                                               ,A.RECPT_NO                                                                                                           
                                               ,A.CUST_NO as CUST_NO                                                                                                            
                                               ,A.REGIS_CANCEL_FG                                                                                                    
                                               ,TO_CHAR(TO_DATE(CANCEL_YMD, 'yyyymmdd'), 'YYYY/MM/DD') AS CANCEL_YMD                                                      
                                               ,A.CREATE_DATE             
                                               ,A.CHILD_NO
                                               ,(SELECT MAX(POS_TYPE) FROM BAPOSMTB WHERE HQ = A.HQ AND STORE = A.STORE AND POS_NO = A.POS_NO) AS POS_TYPE                 
	                              FROM BAPERETB A                                                                                                                                                                                                                                                                                                                  
	                                  ,BACUSTTB B                                                                                                          				                                                                                                                                                                                 
	                                                                                                                                                                                                                                                                                                                          
	                             WHERE A.HQ = B.HQ                                                                                                                                                                                                                                                                                            
	                               AND A.STORE = B.STORE                                                                                                                                                                                                                                                                                      
	                               AND A.CUST_NO = '${cust_no}'                                                                                                                                                                                                                                                                              
	                               AND A.HQ     = 00                                                                                                                                                                                                                                                                                             
	                               AND A.STORE  = '${store}'                                                                                                                                                                                                                                                                                           
	                                                                                                                                                                                                                                                                                                         
	                               AND A.CUST_NO = B.CUST_NO                                                                                                                                                                                               
	                               AND A.regis_cancel_fg <![CDATA[<>]]> '3'                                                                                                                                       
	                               AND A.RECPT_NO <![CDATA[<>]]> '*' 
	                          )AA                                                                                                                                                                                                                                                                                     
	                          ,BAPELTTB BB                                                                                                                                                                                                                                                                                                                      
	                          ,BALECRTB CC                                                                                                                  
	                          ,BATRCATB DD                                                                                                                     
	                     WHERE AA.HQ        = BB.HQ                                                                                                                                                                                                                                                                                                            
	                       AND AA.STORE       = BB.STORE                                                                                                                                                                                                                                                                                                       
	                       AND AA.PERIOD     = BB.PERIOD                                                                                                                                                                                                                                                                                                       
	                       AND AA.SUBJECT_CD  = BB.SUBJECT_CD                                                                                                                                                                                                                                                                                                  
	                       AND BB.LECTURER_CD = CC.LECTURER_CD                                                                                                                                                                                                                                                                                                  
	                       AND BB.HQ          = 00                                                                                                                                                                                                                                                                                                                  
	                       AND BB.STORE       = '${store}'            
	                       <if test="!tid.equals('')">                                                                                                                                                                                                                     
			           		    AND DD.TID = '${tid}'                                                                                               
		                   </if>    
		                   <if test="tid.equals('')">                                                                                                                                                                                                                     
		                   		AND DD.TID is null
		                   </if>                                                                                                                                                                                                                                                                                                                           
	                       AND AA.HQ = DD.HQ(+)                                                                                                             
	                       AND AA.STORE = DD.STORE(+)                                                                                                       
	                       AND AA.SALE_YMD = DD.SALE_YMD(+)                                                                                                 
	                       AND AA.POS_NO = DD.POS_NO(+)
	                       AND AA.POS_NO = '070013'                                                                                                     
	                       AND AA.RECPT_NO = DD.RECPT_NO(+)                                                                                                 
	                 ORDER BY AA.PERIOD DESC , AA.SALE_YMD DESC, AA.CREATE_DATE DESC, AA.POS_NO DESC, AA.RECPT_NO DESC, AA.SUBJECT_CD     
	</select>
	<select id="getMylectureList" parameterType="hashmap" resultType="hashmap">
		
                            
                          SELECT 
                              nvl(
                                  (select child_nm from bachildtb_mu where child_no =AA.CHILD_NO and cust_no='${cust_no}'),
                                  NVL(AA.KOR_NM, ' ')
                              ) cust_nm
                               
                               ,AA.STORE
                               ,AA.PERIOD as GET_PERIOD
	                         ,NVL(AA.SUBJECT_CD, ' ')         SUBJECT_CD                                                                                                                                                                                                                                                                                                      
	                         ,UPPER(NVL(BB.SUBJECT_NM, ' '))  SUBJECT_NM                                                                                                                                                                                                                                                                                                     
	                         ,TRIM(BB.WEB_LECTURER_NM)        LECTURER_NM, BB.MAIN_CD                                                                                                                                                                                                                                                                                     
	                         ,(CASE WHEN SUBSTR(BB.DAY_FLAG, 1, 1) = '1' THEN '월' ELSE '' END)||                                                                                                                                                                                                                                                       
	                          (CASE WHEN SUBSTR(BB.DAY_FLAG, 2, 1) = '1' THEN '화' ELSE '' END)||                                                                                                                                                                                                                                                       
	                          (CASE WHEN SUBSTR(BB.DAY_FLAG, 3, 1) = '1' THEN '수' ELSE '' END)||                                                                                                                                                                                                                                                       
	                          (CASE WHEN SUBSTR(BB.DAY_FLAG, 4, 1) = '1' THEN '목' ELSE '' END)||                                                                                                                                                                                                                                                       
	                          (CASE WHEN SUBSTR(BB.DAY_FLAG, 5, 1) = '1' THEN '금' ELSE '' END)||                                                                                                                                                                                                                                                      
	                          (CASE WHEN SUBSTR(BB.DAY_FLAG, 6, 1) = '1' THEN '토' ELSE '' END)||                                                                                                                                                                                                                                                      
	                          (CASE WHEN SUBSTR(BB.DAY_FLAG, 7, 1) = '1' THEN '일' ELSE '' END)    AS DAY                                                                                                                                                                                                                                          
	                        ,'('||SUBSTR(LECT_HOUR,1,2)||':'||SUBSTR(LECT_HOUR,3,2)||'~'||SUBSTR(LECT_HOUR,5,2)||':'||SUBSTR(LECT_HOUR,7,2)||')' LECT_HOUR                                                                                                                                                                                             
	                        ,TO_CHAR(NVL(BB.REGIS_FEE    ,   0),'999,999') REGIS_FEE                                                                                                                                                                                                                                                                                              
                                     ,NVL(BB.ENURI_PERCENT,   0) ENURI_PERCENT                                                                                                                                                                                                                                                                                                                                                             
                                     ,DECODE(BB.FOOD_YN, 'R', '별도', 'N', '없음', TO_CHAR(NVL(BB.FOOD_AMT    ,   0),'999,999')) FOOD_AMT							   
                                     ,BB.PERIOD                                                                                                                      
                                     ,BB.START_YMD                                                                                                                      
                                     ,BB.END_YMD                                                                                                                      
                                     ,REPLACE((SELECT WEB_TEXT FROM BAPERITB WHERE HQ = 00 AND STORE = 03 AND PERIOD = BB.PERIOD),' ', '<![CDATA[<br/>]]>') AS WEB_TEXT            
                                     ,TO_CHAR(TO_DATE(AA.SALE_YMD, 'yyyymmdd'), 'YYYY') || '<![CDATA[<br/>]]>' || TO_CHAR(TO_DATE(AA.SALE_YMD, 'yyyymmdd'), 'MM/DD') AS PAY_YMD  
                                     ,AA.POS_NO                                                                                                                      
                                     ,AA.RECPT_NO                                                                                                                    
                                     ,AA.SALE_YMD                                                                                                                    
                                     ,cust_no as CUST_NO                                                                                                                        
                                     ,REGIS_CANCEL_FG                                                                                                                
                                     ,CANCEL_YMD                                                                                                                                     
                                     ,POS_TYPE                                                                                                                       
                                     ,DD.TID                                                                                                                         
                                     ,DECODE(DD.CARD_CORP_NO, '822', 'Y', 'N') AS AKCARD_YN                                                    
                                     ,DECODE(DD.CARD_CORP_NO, '042', 'Y', 'N') AS AKKBCARD_YN       
                                     ,DECODE(DD.CARD_CORP_NO, '034', 'Y', 'N') AS AKWBCARD_YN                                           
	                     FROM ( SELECT A.HQ                                                                                                                                                                                                                                                                                                                              
	                                  ,A.STORE                                                                                                                                                                                                                                                                                                                       
	                                  ,A.PERIOD                                                                                                                                                                                                                                                                                                                      
	                                  ,B.KOR_NM                                                                                                                                                                                                                                                                                                                      
	                                  ,A.SUBJECT_CD                                                                                                                
	                                  ,A.PAY_YMD AS SALE_YMD                                                                                                
                                               ,A.POS_NO                                                                                                             
                                               ,A.RECPT_NO                                                                                                           
                                               ,A.CUST_NO AS CUST_NO                                                                                                          
                                               ,A.REGIS_CANCEL_FG                                                                                                    
                                               ,TO_CHAR(TO_DATE(CANCEL_YMD, 'yyyymmdd'), 'YYYY/MM/DD') AS CANCEL_YMD                                                      
                                               ,A.CREATE_DATE             
                                               ,A.CHILD_NO
                                               ,(SELECT MAX(POS_TYPE) FROM BAPOSMTB WHERE HQ = A.HQ AND STORE = A.STORE AND POS_NO = A.POS_NO) AS POS_TYPE                 
	                              FROM BAPERETB A                                                                                                                                                                                                                                                                                                                  
	                                  ,BACUSTTB B                                                                                                          				                                                                                                                                                                                 
	                                                                                                                                                                                                                                                                                                                          
	                             WHERE A.HQ = B.HQ                                                                                                                                                                                                                                                                                            
	                               AND A.STORE = B.STORE                                                                                                                                                                                                                                                                                      
	                               AND A.CUST_NO = '${cust_no}'                                                                                                                                                                                                                                                                              
	                               AND A.HQ     = 00                                                                                                                                                                                                                                                                                             
	                               AND A.STORE  = '${store}'                                                                                                                                                                                                                                                                                           
	                              <if test="!start_ymd.equals('')">                                                                                                                                                                                                                     
				                   		AND A.PERIOD <![CDATA[>=]]> ${start_ymd}  
				                   </if>    
				                    <if test="!end_ymd.equals('')">                                                                                                                                                                                                                     
				                   		AND A.PERIOD <![CDATA[<=]]> ${end_ymd}  
				                   </if>                                                                                                                                                                                                                                                                            
	                               AND A.CUST_NO = B.CUST_NO                                                                                                                                                                                               
	                               AND A.regis_cancel_fg <![CDATA[<>]]> '3' -- 부분 수강 제외                                                                                                                                                            
	                               AND A.RECPT_NO <![CDATA[<>]]> '*' -- 대기강좌 경우                 
	                          )AA                                                                                                                                                                                                                                                                                     
	                          ,BAPELTTB BB                                                                                                                                                                                                                                                                                                                      
	                          ,BALECRTB CC                                                                                                                  
	                          ,BATRCATB DD                                                                                                                     
	                     WHERE AA.HQ        = BB.HQ                                                                                                                                                                                                                                                                                                            
	                       AND AA.STORE       = BB.STORE                                                                                                                                                                                                                                                                                                       
	                       AND AA.PERIOD     = BB.PERIOD                                                                                                                                                                                                                                                                                                       
	                       AND AA.SUBJECT_CD  = BB.SUBJECT_CD                                                                                                                                                                                                                                                                                                  
	                       AND BB.LECTURER_CD = CC.LECTURER_CD                                                                                                                                                                                                                                                                                                  
	                       AND BB.HQ          = 00                                                                                                                                                                                                                                                                                                                  
	                       AND BB.STORE       = '${store}'                                                                                                                                                                                                                                                                                                                  
		           		   <if test="!start_ymd.equals('')">                                                                                                                                                                                                                     
				                AND AA.PERIOD <![CDATA[>=]]> ${start_ymd}  
				           </if>    
				           <if test="!end_ymd.equals('')">                                                                                                                                                                                                                     
				          		AND AA.PERIOD <![CDATA[<=]]> ${end_ymd}  
				           </if>                                                                                                 
	                       AND AA.HQ = DD.HQ(+)                                                                                                             
	                       AND AA.STORE = DD.STORE(+)                                                                                                       
	                       AND AA.SALE_YMD = DD.SALE_YMD(+)                                                                                                 
	                       AND AA.POS_NO = DD.POS_NO(+)                                                                                                     
	                       AND AA.RECPT_NO = DD.RECPT_NO(+)                                                                                                 
	                 ORDER BY AA.PERIOD DESC , AA.SALE_YMD DESC, AA.CREATE_DATE DESC, AA.POS_NO DESC, AA.RECPT_NO DESC, AA.SUBJECT_CD                         
			  
		   	
	</select>
	<insert id="useAKmembersPointLog" parameterType="hashmap">


						INSERT INTO BAPTCATB 
                           (SALE_YMD, HQ, STORE, POS_NO, RECPT_NO, 
                            SLIP_CNT, SSAT_TOT_AMT, ENURI_FG, ENURI_AMT, 
                            CARD_AMT,
                            STAFF_FG, COUPON_NO, CARD_FG, CARD_SEQ, SLIP_SEQ_NO, SLIP_NO,
                            CARD_NO, CARD_VALID, CARD_SEQ_NO, TERM_ID, APRV_NO, ORIGIN_NO,
                            ORIGIN_YMD, INST_FG, INST_MM, VAN_FG, APRV_FG, KEYIN_FG, SIGN_FG,
                            JASA_CARD_IN_FG, CARD_IN_AMT, CUST_SEND_FG, COUPON_SEND_FG,
                            CREATE_RESI_NO, CREATE_DATE, 
                            AKMEM_CUSTNO ,AKMEM_FAMILY_CUSTNO, AKMEM_RECPT_POINT, AKMEM_APPROVE_NO, AKMEM_USE_POINT, VAT_CAL_USE_PT, VAT_CAL_EXT_USE_PT)
                     VALUES (TO_CHAR(SYSDATE, 'YYYYMMDD'), '${hq}', '${store}', '${pos_no}', '${recpt_no}',
                             '1', nvl('${total_show_amt}',0), DECODE('${total_enuri_amt}', 0, 0, 1), nvl('${total_enuri_amt}',0), 
                             (nvl('${total_show_amt}',0) - nvl('${akmem_point_amt}',0)),  
                             '13', null, '5', '01', '0001', NULL,
                             '${AKmem_cardno}', NULL, '998', NULL, NULL, NULL,
                             TO_CHAR(SYSDATE, 'YYYYMMDD'), '0', '0', '00', '1', '0', '0',
                             '0', '${AKmem_SaveApprove_Point}', '0', '0',
                             '${login_seq}', to_char(sysdate, 'YYYYMMDDHH24MISS'),
                             '${AKmem_CustNo}', '${AKmem_Family_CustNo}', 0, '${AKmem_SaveApproveNo_POS}', nvl('${AKmem_Use_Point}',0), nvl('${AKmem_vat_use_pt}',0), nvl('${AKmem_vat_ext_use_pt}',0)
                             )
</insert>
	<insert id="saveAKmembersPointLog" parameterType="hashmap">
			INSERT INTO BAPTCATB 
	                           (SALE_YMD, HQ, STORE, POS_NO, RECPT_NO, 
	                            SLIP_CNT, SSAT_TOT_AMT, ENURI_FG, ENURI_AMT, CARD_AMT,
	                            STAFF_FG, COUPON_NO, CARD_FG, CARD_SEQ, SLIP_SEQ_NO, SLIP_NO,
	                            CARD_NO, CARD_VALID, CARD_SEQ_NO, TERM_ID, APRV_NO, ORIGIN_NO,
	                            ORIGIN_YMD, INST_FG, INST_MM, VAN_FG, APRV_FG, KEYIN_FG, SIGN_FG,
	                            JASA_CARD_IN_FG, CARD_IN_AMT, CUST_SEND_FG, COUPON_SEND_FG,
	                            CREATE_RESI_NO, CREATE_DATE, AKMEM_CUSTNO ,AKMEM_FAMILY_CUSTNO, AKMEM_RECPT_POINT, AKMEM_APPROVE_NO, AKMEM_USE_POINT, VAT_CAL_USE_PT, VAT_CAL_EXT_USE_PT
	                            )  -- 2019.04.19 ljs AKMEM_USE_POINT,VAT_CAL_USE_PT,VAT_CAL_EXT_USE_PT 추가
	                     VALUES (TO_CHAR(SYSDATE,'YYYYMMDD'), '00', '${store}', '${pos_no}', '${recpt_no}',
	                             '2', nvl('${total_show_amt}',0), DECODE('${total_enuri_amt}', 0, 0, 1), nvl('${total_enuri_amt}',0), (nvl('${total_regis_fee}',0) - nvl('${akmem_point_amt}',0)),  -- 2019.04.19 ljs 권오현부장님 의견반영 (사용마일리지 제외처리)
	                             '13', null, '5', '01', '0001', NULL,
	                             '${AKmem_cardno}', NULL, '999', NULL, NULL, NULL,
	                             TO_CHAR(SYSDATE,'YYYYMMDD'), '0', '0', '00', '1', '0', '0',
	                             '0', '${AKmem_SaveApprove_Point}', '0', '0',
	                             '${login_seq}', to_char(sysdate, 'YYYYMMDDHH24MISS'),
	                             '${AKmem_CustNo}', '${AKmem_Family_CustNo}', '${AKmem_recpt_point}', '${AKmem_SaveApproveNo_POS}', '0', '0', '0'    -- 2019.04.19 ljs AKMEM_USE_POINT 추가
	                             )
	</insert>
	<select id="GetAkmemGrade" parameterType="hashmap" resultType="string">
		SELECT NVL(ACM_CODENAME_FN('MS36','${aKmem_CustLevel}'),'Grade_Fail') AS GRADE FROM DUAL
	</select>


	<select id="Check" parameterType="hashmap" resultType="string">
		select cus_no from  AMS_CUS
			where CI ='${ci}'
	</select>
	
	<select id="last_chk" parameterType="hashmap" resultType="string">
		select status from  BAWBRECTB_MU
			where reg_no ='${reg_no}' and cust_no='${cust_no}'
	</select>
	
	
	<select id="Result" parameterType="hashmap" resultType="hashmap">
	        select a.status, a.reg_no, a.kor_nm, to_char(a.modify_date,'yyyy.mm.dd')as modify_date,b.lec_nm ,d.EXAM_DETAIL, a.di, a.ci 
	        from BAWBRECTB a, BAWBPLATB b ,bawbcurtb c,bawbexamtb d	      
	         where a.ci = b.ci																	   --CI변경 (2017.05.25)  DI 추가 (2013.04.08);                      
	           and b.ci = c.ci																	
	           and c.ci = a.ci																	
	           and a.reg_no =  b.reg_no													
	           and b.reg_no = c.reg_no													
	           and a.reg_no = c.reg_no													
	           and a.reg_no = d.reg_no(+)												
	           and c.week='1'																	
	           and a.status NOT LIKE 'D'													
	           and a.modify_user = '${usrid}'														
	           and a.reg_no in (select reg_no from BAWBRECTB where ci = '${ci}' )	    -- CI변경 (2017.05.25)  DI 추가 (2013.04.08);                                                                                                                                                                                                   
	         order by a.modify_date			
	</select>

	<select id="getRegNo" resultType="string">
		select nvl(to_char(max(to_number(reg_no))+1), 0) as reg_no from bawbrectb_mu where cust_no='${cust_no}'
	</select>


	<select id="usr_info" parameterType="hashmap" resultType="hashmap"> 
          select * from bacusttb# where cust_no ='${cust_no}' 
	</select>


	<insert id="insWBREC" parameterType="hashmap">
			<!-- 
			insert into BAWBRECTB
			(
						REG_NO,			KOR_NM,		STATUS,			CREATE_DATE,	CREATE_USER,	MODIFY_DATE,	MODIFY_USER, 
					 	POST_NO1,		POST_NO2,	ADDR_TX1,		ADDR_TX2,					
					 	H_PH0NE_1,		H_PH0NE_2,	H_PH0NE_3,							
					  	M_PH0NE_1,		M_PH0NE_2,	M_PH0NE_3,							
					  	C_PH0NE_1,		C_PH0NE_2,	C_PH0NE_3,		EMAIL,					
					  	SCH_NM,			SCH_MAJOR,	SCH_YY,			SCH_PLACE,		SCH_STATE,			
					  	UNI_NM,			UNI_MAJOR,	UNI_YY,			UNI_PLACE,		UNI_STATE,			
				  		GRA_NM,			GRA_MAJOR,	GRA_YY,			GRA_PLACE,		GRA_STATE,			
				  		FILE_NM,		FILE_SIZE,	FILE_PATH,		H_NEW_ADDR_YN,             
                        DI,				BIRTH_YMD,	SEX_FG,		HOM_ADDR_IN_FG,	CI    
              )	             													
			values  
			(
						'${reg_no}',						'${KOR_NM}','N',	sysdate,			'${User_id}',			sysdate,		'${User_id}',	    				    
				        '${POST_NO1}',						'${POST_NO2}',		'${ADDR_TX1}',		'${ADDR_TX2}',												
	   					REPLACE('${PHONE_NO1}',' ',''),		'${PHONE_NO2}',		'${PHONE_NO3}',												
   					    REPLACE('${H_PHONE_NO_1}',' ',''),	'${H_PHONE_NO_2}',	'${H_PHONE_NO_3}',												
   					    '',									'',					'',					'${EMAIL_ADDR}',												
   					    '',									'',					'',					'',					'',											
   					    '',									'',					'',					'',					'',											
   					    '',									'',					'',					'',					'',											
   					    '',									'',					'',					'',                                             
                        '${DI}',							'${BIRTH_YMD}',		'${SEX_FG}',		decode('${RSP_CD}',null,null,decode('${HOM_ADDR_IN_FG}',null,'2','${HOM_ADDR_IN_FG}')),'${CI}')               	 	     			        
			 -->
			 insert into bawbrectb_mu
			 (
			 	REG_NO,			CUST_NO,		STATUS,	 CREATE_DATE
			 )
			 values
			 (
			 	'${reg_no}',	'${CUST_NO}',	'N',	TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
			 )
	
	</insert>
	<!-- 
	<insert id="insWBHIS" parameterType="hashmap">

			insert into BAWBHISTB
				(
						REG_NO,         					  						
						CAR1_FROM,		CAR1_TO,			CAR1_DETAIL,					
						CAR2_FROM,		CAR2_TO,			CAR2_DETAIL,					
						CAR3_FROM,		CAR3_TO,			CAR3_DETAIL,					
						CAR4_FROM,		CAR4_TO,			CAR4_DETAIL,						
						CAR5_FROM,		CAR5_TO,			CAR5_DETAIL,						
						LEC_CAR1_FROM,	LEC_CAR1_TO,		LEC_CAR1_DETAIL,		
						LEC_CAR2_FROM,	LEC_CAR2_TO,		LEC_CAR2_DETAIL,		
						LEC_CAR3_FROM,	LEC_CAR3_TO,		LEC_CAR3_DETAIL,		
						LEC_CAR4_FROM,	LEC_CAR4_TO,		LEC_CAR4_DETAIL,		
						LEC_CAR5_FROM,	LEC_CAR5_TO,		LEC_CAR5_DETAIL,		
						CER_PLACE1,		CER_DETAIL1,		CER_ACCEPT_YMD1,				
						CER_PLACE2,		CER_DETAIL2,		CER_ACCEPT_YMD2,				
						CER_PLACE3,		CER_DETAIL3,		CER_ACCEPT_YMD3,			
						CER_PLACE4,		CER_DETAIL4,		CER_ACCEPT_YMD4,			
						CER_PLACE5,		CER_DETAIL5,		CER_ACCEPT_YMD5,			
                     	DI, CI                                                   
				)												
			values(
						'${reg_no}',								                
				        '',				'',					'',											
				        '',				'',					'',												
				        '',				'',					'',											
				        '',				'',					'',										
				        '',				'',					'',											
				        '',				'',					'',										
				        '',				'',					'',											
				        '',				'',					'',											
				        '',				'',					'',											
				        '',				'',					'',												
				        '',				'',					'',												
				        '',				'',					'',											
				        '',				'',					'',											
				        '',				'',					'',											
				        '',				'',					'',										    
	                    '${DI}','${CI}'                                                    
			       )													            	 	     			        

	</insert>
	 -->
	<insert id="insWBPLA" parameterType="hashmap">

			  insert into bawbplatb_mu
			  (
			  	REG_NO,        	CUST_NO
			  )	 
				values
			  (
				'${reg_no}',	'${CUST_NO}'
			  )				   	     			   												            	 	     			        

	</insert>
	
	<!-- 
	<insert id="insWBCUR" parameterType="hashmap">

			INSERT INTO BAWBCURTB							
			(
				REG_NO,WEEK, DETAIL, PREPARE, DI, CI
			)		
			VALUES
			(
				'${reg_no}',' ','','','${DI}','${CI}'
			) 									     		   	     			   												            	 	     			        

	</insert>
	 -->
	<!-- 
	<insert id="insApply" parameterType="String">

			  insert into baapplytb
			  (
			  	REG_NO, CREATE_DATE, CUST_NO
			  )	 
				values
			  (
				#{reg_no}, TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS'), #{cust_no}
			  )				   	     			   												            	 	     			        

	</insert>
	-->
	<!--  
	<insert id="insContract" parameterType="String">

			  insert into bacontracttb
			  (
			  	REG_NO, CREATE_DATE
			  )	 
				values
			  (
				#{reg_no}, TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')	
			  )				   	     			   												            	 	     			        

	</insert>	
	-->
	
	<select id="tempAsCheck" parameterType="hashmap" resultType="int">
		 SELECT COUNT(SUBJECT_CD) AS SUB_CNT FROM BATEMPTB	
	             WHERE HQ = '00'																
	             AND STORE =	'${store}'																
	             AND cust_no = '${attendCustNo}'															
	             AND SESSIONID = '${sessionid}'															
	             AND SUBJECT_CD NOT IN (${Tot_subject_cd})					
	</select>
	<select id="retrieveTotAmtCheck" parameterType="hashmap" resultType="hashmap">
		 select nvl(sum(regis_fee),0) regis_fee            
	             ,nvl(sum(food_amt),0)  food_amt                  
	             from BAPELTTB                                    
	             where hq         = '00'                             
	            and store      = '${store}'                                
	            and period     = '${period}'                                
	            and subject_cd  in  (  select subject_cd          
	             from batemptb                                    
	             where hq        = '00'                              
	            and store     = '${store}'                                 
	            and cust_no   = '${attendCustNo}'                                 
	            and pay_date is not null                          
	            and sessionid = '${sessionId}' 
	            and subject_cd in (${tot_subject_cd}) )                               			
	</select>
	
	<select id="ApplyListInfo" parameterType="hashmap" resultType="hashmap">
		 select * from bawbrectb_mu 
		 	where cust_no = '${cust_no}'
	          and reg_no = '${reg_no}'
	</select>
	
	<select id="ApplyListInfo2" parameterType="hashmap" resultType="hashmap">
		 select * from BAWBPLATB_MU 
		 	where cust_no = '${cust_no}'
	          and reg_no = '${reg_no}'
	</select>
	<!-- 
	<select id="recruitPhoto" parameterType="hashmap" resultType="String">
		select FILE_NM from  bawbrectb_mu 
			    where reg_no = '${reg_no}'                       			
	</select>
	<select id="recruitFileInfo" parameterType="hashmap" resultType="hashmap">
		select FILE_NM
		from  bawbrectb_mu       
		where reg_no = '${reg_no}'                    			
	</select>
	 -->
	<select id="retrieveRealCheck" parameterType="ak_web.model.web.LectureVo" resultType="int">
		SELECT nvl(count(*),0) cnt                      
	              FROM baperetb a, bawbtrtb# b                  
	             WHERE a.hq = b.hq                              
	             and a.store = b.store                          
	             and a.period = b.period                        
	             and a.sale_ymd = b.sale_ymd                    
	             and a.hq         = '${hq}'                           
	             and a.store      = '${store}'                           
	             and a.period     = '${period}'                           
	             and a.cust_no    = '${custNo}'                           
	             and a.sale_ymd   = '${sale_ymd}'                           
	             and a.pos_no     = '${pos_no}'                           
	             and a.recpt_no   = '${recpt_no}'                           
	             and a.pay_yn     = 'Y'                         
	             and a.regis_cancel_fg  = '1'                   
	             and a.recpt_no = b.send_recpt_no               
	</select>
	<select id="retrieveCancelCheck" parameterType="ak_web.model.web.LectureVo" resultType="string">
		SELECT nvl(CANCEL_YN,'N') as cancelCheck  
	              FROM batrmstb                       
	             WHERE hq         = '${hq}'                 
	              and store       = '${store}'                 
	              and sale_ymd    = '${sale_ymd}'                 
	              and pos_no      = '${pos_no}'                 
	              and recpt_no    = '${recpt_no}'                 
	</select>
	<select id="retrieveCloseCheck" parameterType="ak_web.model.web.LectureVo" resultType="int">
		SELECT nvl(count(*),0) cnt                      
	              FROM bapelttb# a, baperetb b                  
	             WHERE a.hq = b.hq                              
	               and a.store = b.store                        
	               and a.period = b.period                      
	               and a.subject_cd = b.subject_cd              
	               and b.hq         = '${hq}'                         
	               and b.store      = '${store}'                         
	               and b.period     = '${period}'                         
	               and b.cust_no    = '${custNo}'                         
	               and b.sale_ymd   = '${sale_ymd}'                         
	               and b.pos_no     = '${pos_no}'                         
	               and b.recpt_no   = '${recpt_no}'                         
	               and b.pay_yn     = 'Y'                       
	               and b.regis_cancel_fg  = '1'                 
	               and to_char(sysdate,'yyyymmdd') <![CDATA[>]]> trim(nvl(a.web_cancel_ymd,00000000))                  
	</select>
	<select id="retrieveStartCheck" parameterType="ak_web.model.web.LectureVo" resultType="int">
		 SELECT nvl(count(*),0) cnt                      
	              FROM bapelttb# a, baperetb b                  
	             WHERE a.hq = b.hq                              
	             and a.store = b.store                          
	             and a.period = b.period                        
	             and a.subject_cd = b.subject_cd                
	             and b.hq         = '${hq}'                               
	             and b.store      = '${store}'                            
	             and b.period     = '${period}'                           
	             and b.cust_no    = '${custNo}'                           
	             and b.sale_ymd   = '${sale_ymd}'                         
	             and b.pos_no     = '${pos_no}'                           
	             and b.recpt_no  = '${recpt_no}'                         
	             and b.pay_yn     = 'Y'                         
	             and b.regis_cancel_fg  = '1'                   
	             and to_char(sysdate,'yyyymmdd') <![CDATA[>]]> trim(a.start_ymd)                  
	</select>
	<select id="retrievePeriodCheck" parameterType="ak_web.model.web.LectureVo" resultType="int">
		 SELECT nvl(count(*),0) cnt                      
	              FROM BAPERITB                                 
	             WHERE HQ = '${hq}'                                   
	               AND STORE = '${store}'                                
	               AND PERIOD = '${period}'                               
	               AND TO_CHAR(SYSDATE, 'YYYYMMDD') <![CDATA[>]]> END_YMD                  
	</select>
	<select id="getPointAKmem" parameterType="ak_web.model.web.LectureVo" resultType="hashmap">
		SELECT sum(TO_CHAR(NVL(C.AKMEM_RECPT_POINT  ,   0),'999999')) AS AKMEM_RECPT_POINT,     
		            	        sum(TO_CHAR(NVL(C.AKMEM_USE_POINT    ,   0),'999999')) AS AKMEM_USE_POINT       
		            	   FROM BATRMSTB A,                                                                     
		            	        BATRDETB B,                                                                     
		            	        BAWBPTTB C                                                                      
		            	  WHERE A.SALE_YMD  = '${sale_ymd}'                                                                 
		            	    AND A.HQ        = '${hq}'                                                                 
		            	    AND A.STORE     = '${store}'                                                                 
		            	    AND A.POS_NO    = '${pos_no}'                                                                 
		            	    AND A.RECPT_NO  = '${recpt_no}'                                                                 
		            	    AND A.SALE_YMD  = B.SALE_YMD                                                        
		            	    AND A.HQ        = B.HQ                                                              
		            	    AND A.STORE     = B.STORE                                                           
		            	    AND A.POS_NO    = B.POS_NO                                                          
		            	    AND A.RECPT_NO  = B.RECPT_NO                                                        
		            	    AND B.HQ        = C.HQ(+)                                                           
		            	    AND B.STORE     = C.STORE(+)                                                        
		            	    AND B.SALE_YMD  = C.SALE_YMD(+)                                                     
		            	    AND B.POS_NO    = C.POS_NO(+)                                                       
		            	    AND B.RECPT_NO  = C.RECPT_NO(+)                                                                 
	</select>
	<select id="retrieveFreePayCheck" parameterType="ak_web.model.web.LectureVo" resultType="int">
		SELECT nvl(count(*),0) cnt                      
	              FROM baperetb a, bawbtrtb# b                  
	             WHERE a.hq = b.hq                              
	             and a.store = b.store                          
	             and a.period = b.period                        
	             and a.cust_no = b.cust_no                      
	             and a.sale_ymd = b.sale_ymd                    
	             and a.recpt_no = b.send_recpt_no               
	             and a.hq         = '${hq}'                           
	             and a.store      = '${store}'                           
	             and a.period     = '${period}'                           
	             and a.cust_no    = '${custNo}'                           
	             and a.sale_ymd   = '${sale_ymd}'                           
	             and a.pos_no     = '${pos_no}'                           
	             and a.recpt_no   = '${recpt_no}'                           
	             and a.pay_yn     = 'Y'                         
	             and a.regis_cancel_fg  = '1'                   
	             and b.free_yn   = 'Y'                          
	</select>
	<select id="retrieveGiftCheck" parameterType="ak_web.model.web.LectureVo" resultType="int">
		SELECT nvl(count(*),0) cnt     
	              FROM bagifttb                
	             WHERE hq       = '${hq}'            
	               and store     = '${store}'           
	               and period    = '${period}'           
	               and cust_no   = '${custNo}'           
	               and gift_fg   = '1'         
	</select>
	<select id="retrieveFreeCheck" parameterType="ak_web.model.web.LectureVo" resultType="int">
		SELECT NVL(COUNT(*),0) CNT	
	              FROM BAFREETB						
	             WHERE HQ			= '${hq}'				
	               AND STORE		= '${store}'				
	               AND PERIOD		= '${period}'				
	               AND cust_no	= '${custNo}'				
	               AND PAY_YN	= 'Y'		
	               AND FREE_YMD	= '${sale_ymd}'				
	               AND POS_NO 	= '${pos_no}'				
	               AND RECPT_NO	= '${recpt_no}'				
	</select>
	<select id="selectCancelMailCnt" parameterType="ak_web.model.web.LectureVo" resultType="int">
		 select nvl(count(*),0) pay_cnt  
	             from bawbtrtb a, bacusttb b     
	             where a.hq = b.hq               
	               and a.store = b.store         
	               and a.cust_no = b.cust_no     
	               and a.hq  = '${hq}'                 
	               and a.store = '${store}'               
	               and a.period = '${period}'              
	               and a.cust_no = '${custNo}'             
	               and a.sale_ymd = to_char(sysdate,'yyyymmdd')            
	               and a.sale_time = '${sale_time}'           
	               and a.sale_fg ='02'            			
	</select>
	<select id="selectCardList" parameterType="ak_web.model.web.LectureVo" resultType="hashmap">
		 select  hq, store, card_no, substr(valid_date,3,6) as valid_date, inst_mm, card_amt, approve_no, substr(sale_ymd,3,6) as  sale_ymd, van_fg     
	             from bawbtrtb     
	             where hq = '${hq}'                               
	              and store = '${store}'                             
	              and period = '${period}'                            
	              and cust_no = '${custNo}'                           
	              and sale_ymd = '${sale_ymd}'                          
	              and send_recpt_no  = '${recpt_no}'                    
	              and pos_type  = decode('${pos_no}', '070013', 'W','M')  
	</select>
	<select id="getAkmemNotCancel" parameterType="ak_web.model.web.LectureVo" resultType="hashmap">
		  select AKMEM_CARD_NO, AKMEM_SCARD_NO, AKMEM_CUSTNO, AKMEM_FAMILY_CUSTNO, SUM(AKMEM_RECPT_POINT) AS AKMEM_RECPT_POINT,  
	            	 TOTAL_SHOW_AMT, TOTAL_REGIS_FEE, TOTAL_REGIS_FEE, SYSTEM_DATE, RECPT_NO, SUM(USE_POINT) AS USE_POINT ,SUM(AKMEM_APPROVE_NO_SAVE) AS AKMEM_APPROVE_NO_SAVE,SUM(AKMEM_APPROVE_NO_USE) AS AKMEM_APPROVE_NO_USE 
	            	 from (  
		             SELECT NVL( (SELECT MAX(CARD_NO) FROM AMS_CARD A WHERE CUS_NO = AKMEM_CUSTNO AND HI_UPR_BL IS NULL)        
		                   ,(SELECT MAX(CARD_NO) FROM AMS_CARD A WHERE CUS_NO = AKMEM_CUSTNO) ) AS AKMEM_CARD_NO,                    
		                    B.CARD_NO AS AKMEM_SCARD_NO,                   
		                    A.AKMEM_CUSTNO,                                
		                    A.AKMEM_FAMILY_CUSTNO,                         
		                    A.AKMEM_RECPT_POINT,                           
		                    decode(A.CARD_SEQ_NO,'998',A.AKMEM_APPROVE_NO,0) AS AKMEM_APPROVE_NO_USE,                          
		                    decode(A.CARD_SEQ_NO,'999',A.AKMEM_APPROVE_NO,0) AS AKMEM_APPROVE_NO_SAVE,                           
		                    A.SSAT_TOT_AMT AS TOTAL_SHOW_AMT,              
		                    A.CARD_AMT AS  TOTAL_REGIS_FEE,                
		                    TO_CHAR(SYSDATE,'YYYYMMDD') AS SYSTEM_DATE,    
		                    A.AKMEM_RECPT_NO   AS RECPT_NO,                
		                    nvl(A.AKMEM_USE_POINT,'0')  AS USE_POINT       
		             FROM  BAWBPTTB A, BATRCATB B                          
		               WHERE A.HQ   = B.HQ                                 
		                 AND A.STORE = B.STORE                             
		                 AND A.SALE_YMD = B.SALE_YMD                       
		                 AND A.POS_NO  = B.POS_NO                          
		                 AND A.RECPT_NO = B.RECPT_NO                       
		                 AND A.HQ        = '${hq}'                               
		                 AND A.STORE     = '${store}'                               
		                 AND A.SALE_YMD  = '${sale_ymd}'                               
		                 AND A.POS_NO    = '${pos_no}'                               
		                 AND A.RECPT_NO  = '${recpt_no}'                               
		             ) 
		             GROUP BY AKMEM_CARD_NO, AKMEM_SCARD_NO, AKMEM_CUSTNO, AKMEM_FAMILY_CUSTNO, 
		             TOTAL_SHOW_AMT, TOTAL_REGIS_FEE, TOTAL_REGIS_FEE, SYSTEM_DATE, RECPT_NO 
	</select>
	<select id="getAkmemCancel" parameterType="ak_web.model.web.LectureVo" resultType="hashmap">
		   SELECT NVL( (SELECT MAX(CARD_NO) FROM AMS_CARD A WHERE CUS_NO = AKMEM_CUSTNO AND HI_UPR_BL IS NULL)        
		                   ,(SELECT MAX(CARD_NO) FROM AMS_CARD A WHERE CUS_NO = AKMEM_CUSTNO) ) AS AKMEM_CARD_NO,                    
		                    '0000000000000000' AS AKMEM_SCARD_NO,          
		                    A.AKMEM_CUSTNO,                                
		                    A.AKMEM_FAMILY_CUSTNO,                         
		                    A.AKMEM_RECPT_POINT,                           
		                    A.AKMEM_APPROVE_NO,                            
		                    A.SSAT_TOT_AMT AS TOTAL_SHOW_AMT,              
		                    A.CARD_AMT AS  TOTAL_REGIS_FEE,                
		                    TO_CHAR(SYSDATE,'YYYYMMDD') AS SYSTEM_DATE,    
		                    A.AKMEM_RECPT_NO   AS RECPT_NO,                
		                    nvl(A.AKMEM_USE_POINT,'0')  AS USE_POINT       
		             FROM  BAWBPTTB A                                      
		               WHERE A.HQ        = '${hq}'                               
		                 AND A.STORE     = '${store}'                               
		                 AND A.SALE_YMD  = '${sale_ymd}'                               
		                 AND A.POS_NO    = '${pos_no}'                               
		                 AND A.RECPT_NO  = '${recpt_no}'                               
	</select>
	<select id="selectCancelPointCnt" parameterType="ak_web.model.web.LectureVo" resultType="int">
		  SELECT nvl(count(*),0) pay_cnt 
	             FROM  BAWBPTTB                 
	               WHERE HQ        = '${hq}'          
	                 AND STORE     = '${store}'          
	                 AND SALE_YMD  = '${sale_ymd}'          
	                 AND POS_NO    = '${pos_no}'          
	                 AND RECPT_NO  = '${recpt_no}'          
	                 AND SSAT_TOT_AMT  = 0      
	</select>
	<select id="getCancelLectCntCount_01" parameterType="ak_web.model.web.LectureVo" resultType="int">
		  SELECT  NVL(SUM(CNT),0)  AS  lect_cnt_count           
	                 FROM (                                            					    
	                         SELECT  COUNT(*) AS CNT								 
	                           FROM BAWBTRTB# A, BAPELTTB# B               
	                           WHERE A.HQ         = B.HQ                   
	                             AND A.STORE      = B.STORE                
	                             AND A.PERIOD     = B.PERIOD               
	                             AND A.SUBJECT_CD = B.SUBJECT_CD           
	                             AND A.HQ         = '${hq}'                				      
	                             AND A.STORE      = '${store}'              			        
	                             AND A.PERIOD     = '${period}'                      
	                             AND A.CUST_NO    = '${custNo}'                      
	                             AND A.SEND_YN    = 'N'                    
	                 			 AND SALE_FG ='01'  						  
	                 			 AND CANCEL_YN ='N'  							                
	                             AND (B.LECT_CNT   <![CDATA[>]]> 9 OR (SUBSTR(B.SUBJECT_CD,1,3) = '620' )) 
	                         UNION ALL                                     
	                         SELECT COUNT(*) AS CNT                        
	                           FROM BAPERETB A, BAPELTTB# B                
	                          WHERE A.HQ         = B.HQ                    
	                            AND A.STORE      = B.STORE                 
	                            AND A.PERIOD     = B.PERIOD                
	                            AND A.SUBJECT_CD = B.SUBJECT_CD            
	                            AND A.HQ         = '${hq}'                           
	                            AND A.STORE      = '${store}'                        
	                            AND A.PERIOD     = '${period}'                       
	                            AND A.CUST_NO    = '${custNo}'                       
	                            AND A.PAY_YN     = 'Y'                     
	                            AND A.REGIS_CANCEL_FG = '1'                
	                            AND (B.LECT_CNT   <![CDATA[>]]> 9 OR (SUBSTR(B.SUBJECT_CD,1,3) = '620' )) 
	                       )                                               
	</select>
	<select id="getCancelLectCntCount_02" parameterType="ak_web.model.web.LectureVo" resultType="int">
		  SELECT  NVL(SUM(CNT),0)  AS  lect_cnt_count            
	                 FROM (                                          				       
	                         SELECT  COUNT(*) AS CNT							 
	                           FROM BAWBTRTB# A, BAPELTTB# B                
	                           WHERE A.HQ         = B.HQ                    
	                             AND A.STORE      = B.STORE                 
	                             AND A.PERIOD     = B.PERIOD                
	                             AND A.SUBJECT_CD = B.SUBJECT_CD            
	                             AND A.HQ         = '${hq}'                           
	                             AND A.STORE      = '${store}'                        
	                             AND A.PERIOD     = '${period}'                       
	                             AND A.CUST_NO    = '${custNo}'                       
	                             AND A.SEND_YN    = 'N'                     
	                 			 AND SALE_FG ='01'  						  
	                 			 AND CANCEL_YN ='N'  							                
	                             AND (B.LECT_CNT   <![CDATA[>]]> 9 )                     // 8회이상
	                         UNION ALL                                      
	                         SELECT COUNT(*) AS CNT                         
	                           FROM BAPERETB A, BAPELTTB# B                 
	                          WHERE A.HQ         = B.HQ                     
	                            AND A.STORE      = B.STORE                  
	                            AND A.PERIOD     = B.PERIOD                 
	                            AND A.SUBJECT_CD = B.SUBJECT_CD             
	                            AND A.HQ         = '${hq}'                            
	                            AND A.STORE      = '${store}'                         
	                            AND A.PERIOD     = '${period}'                        
	                            AND A.CUST_NO    = '${custNo}'                        
	                            AND A.PAY_YN     = 'Y'                      
	                            AND A.REGIS_CANCEL_FG = '1'                 
	                            AND (B.LECT_CNT   <![CDATA[>]]> 9 )                      // 8회이상
	                       )                                                
	</select>
	<select id="getCancelLectCntCount_03" parameterType="ak_web.model.web.LectureVo" resultType="int">
		  SELECT  NVL(SUM(CNT),0)  AS  lect_cnt_count    
	                 FROM (                                               			 
	                         SELECT COUNT(*) AS CNT						 
	                           FROM BAWBTRTB# A, BAPELTTB# B           
	                           WHERE A.HQ         = B.HQ                   	  
	                             AND A.STORE      = B.STORE                 
	                             AND A.PERIOD     = B.PERIOD                
	                             AND A.SUBJECT_CD = B.SUBJECT_CD            
	                             AND A.HQ         = '${hq}'                           
	                             AND A.STORE      = '${store}'                        
	                             AND A.PERIOD     = '${period}'                       
	                             AND A.CUST_NO    = '${custNo}'                       
	                             AND A.SEND_YN    = 'N'                     
	                 			 AND SALE_FG ='01'  						  
	                 			 AND CANCEL_YN ='N'  							
	                             AND (substr(B.SUBJECT_CD,1,3) <![CDATA[<>]]> '414') AND (B.LECT_CNT  <![CDATA[>]]> 9 OR ( B.SUBJECT_CD in ('620001','620002')) )   
	                         UNION ALL                                      
	                         SELECT COUNT(*) AS CNT                         
	                           FROM BAPERETB A, BAPELTTB# B                 
	                          WHERE A.HQ         = B.HQ                     
	                            AND A.STORE      = B.STORE                  
	                            AND A.PERIOD     = B.PERIOD                 
	                            AND A.SUBJECT_CD = B.SUBJECT_CD             
	                            AND A.HQ         = '${hq}'                            
	                            AND A.STORE      = '${store}'                         
	                            AND A.PERIOD     = '${period}'                        
	                            AND A.CUST_NO    = '${custNo}'                        
	                            AND A.PAY_YN     = 'Y'                      
	                            AND A.REGIS_CANCEL_FG = '1'                 
	                            AND (substr(B.SUBJECT_CD,1,3) <![CDATA[<>]]> '414') AND (B.LECT_CNT  <![CDATA[>]]> 9 OR ( B.SUBJECT_CD in ('620001','620002')) )   
	                       )                                                
	</select>
	<select id="getCancelLectCntCount_04" parameterType="ak_web.model.web.LectureVo" resultType="int">
		  SELECT  NVL(SUM(CNT),0)  AS  lect_cnt_count            
	                 FROM (                                                 
	                         SELECT  COUNT(*) AS CNT		 
	                           FROM BAWBTRTB# A, BAPELTTB# B                
	                           WHERE A.HQ         = B.HQ                    
	                             AND A.STORE      = B.STORE                 
	                             AND A.PERIOD     = B.PERIOD                
	                             AND A.SUBJECT_CD = B.SUBJECT_CD            
	                             AND A.HQ         = '${hq}'                           
	                             AND A.STORE      = '${store}'                        
	                             AND A.PERIOD     = '${period}'                       
	                             AND A.CUST_NO    = '${custNo}'                       
	                             AND A.SEND_YN    = 'N'                     
	                 			 AND SALE_FG ='01'  						  
	                 			 AND CANCEL_YN ='N'  							                
	                             AND (B.LECT_CNT   <![CDATA[>]]> 9 OR (SUBSTR(B.SUBJECT_CD,1,3) = '620'))                   
	                         UNION ALL                                      
	                         SELECT COUNT(*) AS CNT                         
	                           FROM BAPERETB A, BAPELTTB# B                 
	                          WHERE A.HQ         = B.HQ                     
	                            AND A.STORE      = B.STORE                  
	                            AND A.PERIOD     = B.PERIOD                 
	                            AND A.SUBJECT_CD = B.SUBJECT_CD             
	                            AND A.HQ         = '${hq}'                            
	                            AND A.STORE      = '${store}'                         
	                            AND A.PERIOD     = '${period}'                        
	                            AND A.CUST_NO    = '${custNo}'                        
	                            AND A.PAY_YN     = 'Y'                      
	                            AND A.REGIS_CANCEL_FG = '1'                 
	                            AND (B.LECT_CNT   <![CDATA[>]]> 9 OR (SUBSTR(B.SUBJECT_CD,1,3) = '620'))                    
	                       )                                                
	</select>
	<select id="getCancelLectCntCount_05" parameterType="ak_web.model.web.LectureVo" resultType="int">
		  SELECT  NVL(SUM(CNT),0)  AS  lect_cnt_count         								    
	                 FROM (                                            													    
	                         SELECT  COUNT(*) AS CNT																
	                           FROM BAWBTRTB# A, BAPELTTB# B             									    
	                           WHERE A.HQ         = B.HQ                    											
	                             AND A.STORE      = B.STORE               											
	                             AND A.PERIOD     = B.PERIOD              											
	                             AND A.SUBJECT_CD = B.SUBJECT_CD   									        
	                             AND A.HQ         = '${hq}'                           												
	                             AND A.STORE      = '${store}'                        											
	                             AND A.PERIOD     = '${period}'                      												
	                             AND A.CUST_NO    = '${custNo}'                      											
	                             AND A.SEND_YN    = 'N'                  												
	                 			 AND SALE_FG ='01'  																  	
	                 			 AND CANCEL_YN ='N'  																	                
	                             AND (B.LECT_CNT   <![CDATA[>]]> 9 OR (SUBSTR(B.SUBJECT_CD,1,3) = '620'))       
	                         UNION ALL                                 												    
	                         SELECT COUNT(*) AS CNT                     										    
	                           FROM BAPERETB A, BAPELTTB# B                										
	                          WHERE A.HQ         = B.HQ                    											
	                            AND A.STORE      = B.STORE                											
	                            AND A.PERIOD     = B.PERIOD               											
	                            AND A.SUBJECT_CD = B.SUBJECT_CD            									
	                            AND A.HQ         = '${hq}'                          												
	                            AND A.STORE      = '${store}'                        												
	                            AND A.PERIOD     = '${period}'                       												
	                            AND A.CUST_NO    = '${custNo}'                       											
	                            AND A.PAY_YN     = 'Y'                     												
	                            AND A.REGIS_CANCEL_FG = '1'                										
	                            AND (B.LECT_CNT   <![CDATA[>]]> 9 OR (SUBSTR(B.SUBJECT_CD,1,3) = '620'))        
	                       )                                               														
	</select>
	<select id="getGiftCountA" parameterType="ak_web.model.web.LectureVo" resultType="hashmap">
		    SELECT HQ, STORE, cust_no AS GIFT_COUNT   
	                   FROM BAGIFTTB                              			 
	                  WHERE HQ       = '${hq}'                          				 
	                    AND STORE    = '${store}'                          				 
	                    AND PERIOD   = '${period}'                           			 
	                    AND cust_no  = '${custNo}'                         	  		 
	                    AND GIFT_CLASS = 'A'                    		    	 
	                    AND GIFT_FG  = '2'                        				 
	</select>
	<select id="getGiftCountB" parameterType="ak_web.model.web.LectureVo" resultType="hashmap">
		    SELECT HQ, STORE, cust_no AS GIFT_COUNT   
	                   FROM BAGIFTTB                              			 
	                  WHERE HQ       = '${hq}'                          				 
	                    AND STORE    = '${store}'                          				 
	                    AND PERIOD   = '${period}'                           			 
	                    AND cust_no  = '${custNo}'                         	  		 
	                    AND GIFT_CLASS = 'B'                    		    	 
	                    AND GIFT_FG  = '2'                        				 
	</select>
	<select id="getGiftCountC" parameterType="ak_web.model.web.LectureVo" resultType="hashmap">
		    SELECT HQ, STORE, cust_no AS GIFT_COUNT   
	                   FROM BAGIFTTB                              			 
	                  WHERE HQ       = '${hq}'                          				 
	                    AND STORE    = '${store}'                          				 
	                    AND PERIOD   = '${period}'                           			 
	                    AND cust_no  = '${custNo}'                         	  		 
	                    AND GIFT_CLASS = 'C'                    		    	 
	                    AND GIFT_FG  = '2'                        				 
	</select>
	<select id="getGiftCountD" parameterType="ak_web.model.web.LectureVo" resultType="hashmap">
		    SELECT HQ, STORE, cust_no AS GIFT_COUNT   
	                   FROM BAGIFTTB                              			 
	                  WHERE HQ       = '${hq}'                          				 
	                    AND STORE    = '${store}'                          				 
	                    AND PERIOD   = '${period}'                           			 
	                    AND cust_no  = '${custNo}'                         	  		 
	                    AND GIFT_CLASS = 'D'                    		    	 
	                    AND GIFT_FG  = '2'                        				 
	</select>
	<select id="selWebregisnoMinusProcess" parameterType="ak_web.model.web.LectureVo" resultType="hashmap">
		    SELECT store, period,   subject_cd            
	              FROM bawbtrtb#                              
	             WHERE hq         = '${hq}'                         
	               and store      = '${store}'                         
	               and period     = '${period}'                         
	               and cust_no    = '${custNo}'                         
	               and sale_ymd   = '${sale_ymd}'                         
	               and send_recpt_no   = '${recpt_no}'                    
	               and sale_fg    = '01'                       
	               and cancel_yn  = 'Y'                        
	            
	</select>
	<select id="getCancelBookCount" parameterType="ak_web.model.web.LectureVo" resultType="int">
		     SELECT NVL(NULLIF(COUNT(*) ,0) ,0) as CNT		 
	               FROM BAPERETB A, BATEMPTB B						
	              WHERE A.HQ         = '${hq}'									
	                AND A.STORE      = '${store}'									
	                AND A.PERIOD     = '${period}'									
	                AND A.CUST_NO    = '${custNo}'									
	                AND A.SALE_YMD   = '${sale_ymd}'									
	                AND A.POS_NO     = '${pos_no}'									
	                AND A.RECPT_NO   = '${recpt_no}'									
	                AND A.HQ         = B.HQ									
	                AND A.STORE      = B.STORE							
	                AND A.CUST_NO    = B.CUST_NO					
	                AND A.SUBJECT_CD = B.SUBJECT_CD				
	</select>
	<update id="upWebregisnoMinusProcess" parameterType="ak_web.model.web.LectureVo">
		 update BAPELTTB#                             
	            set web_regis_no = nvl(web_regis_no,0) - 1   
	            where hq        = '${hq}'                          
	             and store      = '${store}'                          
	             and period     = '${period}'                          
	             and subject_cd = '${subject_cd}'                          
	</update>
	<update id="upCancelPeltRegis" parameterType="ak_web.model.web.LectureVo">
		 update BAPELTTB#                                   
	                set web_regis_no = nvl(web_regis_no,0) - 1         
	                where hq        = '${hq}'                                
	                 and store      = '${store}'                                
	                 and period     = '${period}'                                
	                 and subject_cd IN ( SELECT SUBJECT_CD             
	                                       FROM BAPERETB               
	                                       WHERE HQ       = '${hq}'          
	                                         AND STORE    = '${store}'          
	                                         AND PERIOD   = '${period}'          
	                                         AND cust_no  = '${custNo}'          
	                                         AND SALE_YMD = '${sale_ymd}'          
	                                         AND POS_NO   = '070013'   
	                                         AND RECPT_NO = '${recpt_no}'       )  
	</update>
	<insert id="insCancelTempLog" parameterType="ak_web.model.web.LectureVo">
		  INSERT INTO BATEMPTB(CUST_IP, CUST_NO, SUBJECT_CD, UPDATE_DATE, SESSIONID, HQ, STORE) 
	                 SELECT '${ipAddress}'           ,                                                                   
	                        cust_no     ,                                                                  
	                        SUBJECT_CD  ,                                                                  
	                        TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS'),                                            
	                        '${sessionId}',                                                                              
	                        HQ,                                                                             
	                        STORE                                                                          
	                   FROM BAPERETB                                                                       
	                  WHERE HQ       = '${hq}'                                                                   
	                    AND STORE    = '${store}'                                                                   
	                    AND PERIOD   = '${period}'                                                                   
	                    AND cust_no  = '${custNo}'                                                                   
	                    AND SALE_YMD = '${sale_ymd}'                                                                   
	                    AND POS_NO   = '${pos_no}'                                                                   
	                    AND RECPT_NO = '${recpt_no}'                                                                   
	</insert>
	<insert id="insCancelTempLog2" parameterType="ak_web.model.web.LectureVo">
		   INSERT INTO BATEMPTB(CUST_IP, CUST_NO, SUBJECT_CD, UPDATE_DATE, SESSIONID, HQ, STORE) 
	                 SELECT '${ipAddress}'           ,                                                                  
	                        cust_no     ,                                                                   
	                        SUBJECT_CD  ,                                                                  
	                        TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS'),                                           
	                        '${sessionId}',                                                                              
	                        HQ,                                                                            
	                        STORE                                                                           
	                   FROM BAPERETB                                                                       
	                  WHERE HQ       = '${hq}'                                                                   
	                    AND STORE    = '${store}'                                                                   
	                    AND PERIOD   = '${period}'                                                                   
	                    AND cust_no  = '${custNo}'                                                                   
	                    AND SALE_YMD = '${sale_ymd}'                                                                   
	                    AND POS_NO   = '070013'                                                            
	                    AND RECPT_NO = '${recpt_no}'                                                                   
	                    AND SUBJECT_CD NOT IN(SELECT SUBJECT_CD FROM BATEMPTB                              
	                                           WHERE cust_no = '${custNo}'              )                            
	</insert>
	<update id="freeCancelProcess" parameterType="ak_web.model.web.LectureVo">
		 update  bafreetb         
	               set pay_yn ='N',       
	                   update_resi_no ='7777888899990',    
	                   update_date =  to_char(sysdate,'yyyymmddhh24miss')  
	               where hq = '${hq}'         
	                 and store = '${store}'      
	                 and period = '${period}'     
	                 and cust_no = '${custNo}'    
	                 and pay_yn = 'Y'   		
	</update>
	<update id="upCancelGiftA" parameterType="ak_web.model.web.LectureVo">
		  UPDATE BAGIFTTB                                             
	                         SET GIFT_FG  = '9',                                      
	                             UPDATE_RESI_NO = '7778889999000',                    
	                             UPDATE_DATE = TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'),  
	                             POS_NO = '070013',                                   
	                             CONTENTS = '온라인취소 고객'                            
	                       WHERE HQ          = '${hq}'                                      
	                         AND STORE       = '${store}'                                      
	                         AND PERIOD      = '${period}'                                      
	                         AND cust_no     = '${custNo}'                                      
	                         AND GIFT_CLASS  = 'A'                                      
	                         AND GIFT_FG  = '2'                                       
	</update>
	<update id="upCancelGiftB" parameterType="ak_web.model.web.LectureVo">
		  UPDATE BAGIFTTB                                             
	                         SET GIFT_FG  = '9',                                      
	                             UPDATE_RESI_NO = '7778889999000',                    
	                             UPDATE_DATE = TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'),  
	                             POS_NO = '070013',                                   
	                             CONTENTS = '온라인취소 고객'                            
	                       WHERE HQ          = '${hq}'                                      
	                         AND STORE       = '${store}'                                      
	                         AND PERIOD      = '${period}'                                      
	                         AND cust_no     = '${custNo}'                                      
	                         AND GIFT_CLASS  = 'B'                                      
	                         AND GIFT_FG  = '2'                                       
	</update>
	<update id="upCancelGiftC" parameterType="ak_web.model.web.LectureVo">
		  UPDATE BAGIFTTB                                             
	                         SET GIFT_FG  = '9',                                      
	                             UPDATE_RESI_NO = '7778889999000',                    
	                             UPDATE_DATE = TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'),  
	                             POS_NO = '070013',                                   
	                             CONTENTS = '온라인취소 고객'                            
	                       WHERE HQ          = '${hq}'                                      
	                         AND STORE       = '${store}'                                      
	                         AND PERIOD      = '${period}'                                      
	                         AND cust_no     = '${custNo}'                                      
	                         AND GIFT_CLASS  = 'C'                                      
	                         AND GIFT_FG  = '2'                                       
	</update>
	<update id="upCancelGiftD" parameterType="ak_web.model.web.LectureVo">
		  UPDATE BAGIFTTB                                             
	                         SET GIFT_FG  = '9',                                      
	                             UPDATE_RESI_NO = '7778889999000',                    
	                             UPDATE_DATE = TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'),  
	                             POS_NO = '070013',                                   
	                             CONTENTS = '온라인취소 고객'                            
	                       WHERE HQ          = '${hq}'                                      
	                         AND STORE       = '${store}'                                      
	                         AND PERIOD      = '${period}'                                      
	                         AND cust_no     = '${custNo}'                                      
	                         AND GIFT_CLASS  = 'D'                                      
	                         AND GIFT_FG  = '2'                                       
	</update>
	
	<select id="getNewsFileName" parameterType="hashmap" resultType="hashmap">
		select file_nm, file_ori from bawbrectb_mu where reg_no = '${reg_no}' and cust_no='${cust_no}'
	</select>
	
	<update id="Save_wbrec" parameterType="hashmap">    
               update bawbrectb_mu set
               		SCH_NM='${school_nm}',					SCH_MAJOR='${major}',					SCH_LEVEL='${school_type}',				SCH_STATE='${school_state}',			
               		SCH_PLACE='${school_from}',				SCH_START_YY='${school_yy_s}',			SCH_END_YY='${school_yy_e}',			CAR1_FROM='${s_career_01}',
				 	CAR1_TO='${e_career_01}',				CAR1_DETAIL='${c_detail_01}',			CAR2_FROM='${s_career_02}',				CAR2_TO='${e_career_02}',				
				 	CAR2_DETAIL='${c_detail_02}', 			CAR3_FROM='${s_career_03}',				CAR3_TO='${e_career_03}',				CAR3_DETAIL='${c_detail_03}',			
				 	CAR4_FROM='${s_career_04}',				CAR4_TO='${e_career_04}',				CAR4_DETAIL='${c_detail_04}', 			CAR5_FROM='${s_career_05}',				
				 	CAR5_TO='${e_career_05}',				CAR5_DETAIL='${c_detail_05}',			AWAD1_DATE='${award_date_01}',			AWAD1_FROM='${award_from_01}',		
				 	AWAD1_DETAIL='${award_detail_01}',		AWAD2_DATE='${award_date_02}',			AWAD2_FROM='${award_from_02}',			AWAD2_DETAIL='${award_detail_02}', 		
				 	AWAD3_DATE='${award_date_03}',			AWAD3_FROM='${award_from_03}',			AWAD3_DETAIL='${award_detail_03}', 		AWAD4_DATE='${award_date_04}',		
				 	AWAD4_FROM='${award_from_04}',			AWAD4_DETAIL='${award_detail_04}',		AWAD5_DATE='${award_date_05}',			AWAD5_FROM='${award_from_05}',			
				 	AWAD5_DETAIL='${award_detail_05}',		CERT1_DATE='${cert_date_01}',			CERT1_FROM='${cert_from_01}',			CERT1_DETAIL='${cert_detail_01}',   	
				 	CERT2_DATE='${cert_date_02}',			CERT2_FROM='${cert_from_02}',			CERT2_DETAIL='${cert_detail_02}',		CERT3_DATE='${cert_date_03}',			
				 	CERT3_FROM='${cert_from_03}',			CERT3_DETAIL='${cert_detail_03}',		CERT4_DATE='${cert_date_04}',			CERT4_FROM='${cert_from_04}',			
				 	<if test="!file_nm.equals('')">
				 		FILE_ORI='${file_ori}',						FILE_NM='${file_nm}',
				 	</if>
				 	CERT4_DETAIL='${cert_detail_04}',   	CERT5_DATE='${cert_date_05}',			CERT5_FROM='${cert_from_05}',			CERT5_DETAIL='${cert_detail_05}'
				where
					cust_no='${cust_no}'
					and reg_no ='${reg_no}'
               		
	</update>
	
	
	<!--  
	<update id="Save_wbhis" parameterType="hashmap">
				UPDATE BAWBHISTB SET 	
					 									
							CAR1_FROM='${car1_from}',	 		CAR1_TO='${car1_to}', 			CAR1_DETAIL='${car1_detail}', 		
							CAR2_FROM='${car2_from}', 			CAR2_TO='${car2_to}',		 	CAR2_DETAIL='${car2_detail}', 		
							CAR3_FROM='${car3_from}', 			CAR3_TO='${car3_to}', 			CAR3_DETAIL='${car3_detail}', 	
						    CAR4_FROM='${car4_from}', 			CAR4_TO='${car4_to}', 			CAR4_DETAIL='${car4_detail}', 	
						    CAR5_FROM='${car5_from}', 			CAR5_TO='${car5_to}', 			CAR5_DETAIL='${car5_detail}', 
							LEC_CAR1_FROM='${lec_car1_from}', 	LEC_CAR1_TO='${lec_car1_to}', 	LEC_CAR1_DETAIL='${lec_car1_detail}',
							LEC_CAR2_FROM='${lec_car2_from}', 	LEC_CAR2_TO='${lec_car2_to}', 	LEC_CAR2_DETAIL='${lec_car2_detail}', 								
							LEC_CAR3_FROM='${lec_car3_from}', 	LEC_CAR3_TO='${lec_car3_to}', 	LEC_CAR3_DETAIL='${lec_car3_detail}', 
							LEC_CAR4_FROM='${lec_car4_from}', 	LEC_CAR4_TO='${lec_car4_to}', 	LEC_CAR4_DETAIL='${lec_car4_detail}', 									
							LEC_CAR5_FROM='${lec_car5_from}', 	LEC_CAR5_TO='${lec_car5_to}', 	LEC_CAR5_DETAIL='${lec_car5_detail}', 
						    CER_PLACE1='${cer1_place}',			CER_DETAIL1='${cer1_detail}', 	CER_ACCEPT_YMD1='${cer1_accept_ymd}', 	
						    CER_PLACE2='${cer2_place}', 		CER_DETAIL2='${cer2_detail}', 	CER_ACCEPT_YMD2='${cer2_accept_ymd}', 
							CER_PLACE3='${cer3_place}', 		CER_DETAIL3='${cer3_detail}', 	CER_ACCEPT_YMD3='${cer3_accept_ymd}', 									
							CER_PLACE4='${cer4_place}', 		CER_DETAIL4='${cer4_detail}', 	CER_ACCEPT_YMD4='${cer4_accept_ymd}', 									
							CER_PLACE5='${cer5_place}', 		CER_DETAIL5='${cer5_detail}', 	CER_ACCEPT_YMD5='${cer5_accept_ymd}'									
				WHERE
						CI ='${ci}'	
					AND REG_NO ='${reg_no}'
	</update>
	-->
	<select id="getNewsFileName2" parameterType="hashmap" resultType="hashmap">
		select file_nm, file_ori from BAWBPLATB_MU where reg_no = '${reg_no}' and cust_no='${cust_no}'
	</select>
	
	<update id="Save_wbpla" parameterType="hashmap">
				UPDATE BAWBPLATB_MU SET 	
					APLY_TYPE='${class_type}',	 		APLY_STORE='${store}', 			APLY_DAY='${yoil}', 		
					APLY_LECT_HOUR='${lect_hour}', 		LEC_NM='${lect_nm}',		 	LEC_INFO='${lect_info}', 		
					SIG_INFO='${sig_info}', 			LEC_MAIN_CD='${main_cd}', 		SUBJECT_FG='${subject_fg}'
					<if test="!file_nm.equals('')">
				 		,FILE_ORI='${file_ori}',						FILE_NM='${file_nm}'
				 	</if>
				where
					cust_no='${cust_no}'
					and reg_no ='${reg_no}'
	</update>
	<select id="getSubjectTax" parameterType="hashmap" resultType="hashmap">
		select
		(select short_name from bacodetb where CODE_FG = '02' and sub_code = bapelttb.store) as store_nm,
		bapelttb.*
		from bapelttb 
		where 
		store in (${branch}) 
		and period in (select period from baperitb where web_text = '${web_text}' and store in (${branch}))
		and (cus_no = '${cus_no}' or cus_no1 = '${cus_no}')
	</select>
	<select id="getSubjectCert" parameterType="hashmap" resultType="hashmap">
		select
		(select short_name from bacodetb where CODE_FG = '02' and sub_code = bapelttb.store) as store_nm,
		bapelttb.*
		from bapelttb 
		where 
		store in (${branch}) 
		and period in (select period from baperitb where (end_ymd <![CDATA[>=]]> '${start_ymd}' and start_ymd <![CDATA[<=]]> '${start_ymd}') or (end_ymd <![CDATA[>=]]> '${end_ymd}' and start_ymd <![CDATA[<=]]> '${end_ymd}') and store in (${branch}))
		and (cus_no = '${cus_no}' or cus_no1 = '${cus_no}')
	</select>
	<select id="getLecrByCus" parameterType="hashmap" resultType="hashmap">
		select balecrtb.*, ams_cus_addr.* from balecrtb, ams_cus_addr where balecrtb.cus_no = '${cus_no}' and ams_cus_addr.cus_no = '${cus_no}'
	</select>
	<select id="getJr" parameterType="hashmap" resultType="hashmap">
		select * from bajr${tb}tb where store = '${store}' and period = '${period}' and lecturer_cd = '${lecturer_cd}' 
		<if test="!subject_cd.equals('')">
			and subject_cd in (${subject_cd})
		</if>
	</select>
	<select id="getSubjectNm" parameterType="hashmap" resultType="string">
		select subject_nm from bapelttb where store = '${store}' and period = '${period}' and subject_cd = '${subject_cd}'
	</select>
	<select id="getNewsOne" parameterType="hashmap" resultType="hashmap">
		SELECT A.*
		FROM (
		    SELECT
		        banewstb_mu.*,
		        nvl((select short_name from bacodetb where CODE_FG = '02' and sub_code = banewstb_mu.store), '전 지점') as store_nm,
				nvl(banewstb_mu.views, 0) as nvl_views,
		        LEAD(seq, 1) OVER (ORDER BY sort) AS NEXT_NO,
		        LEAD(category, 1) OVER (ORDER BY sort) AS NEXT_CATEGORY,
		        LEAD(create_date, 1) OVER (ORDER BY sort) AS NEXT_CREATE_DATE,
		        LEAD((nvl((select short_name from bacodetb where CODE_FG = '02' and sub_code = store), '전 지점')), 1) OVER (ORDER BY sort) AS NEXT_STORE_NM,
		        LEAD(title, 1, '다음글이 없습니다') OVER (ORDER BY sort) AS NEXT_TITLE,
		        LAG(seq, 1) OVER (ORDER BY sort) AS PRE_NO,
		        LAG(category, 1) OVER (ORDER BY sort) AS PRE_CATEGORY,
		        LAG(create_date, 1) OVER (ORDER BY sort) AS PRE_CREATE_DATE,
		        LAG((nvl((select short_name from bacodetb where CODE_FG = '02' and sub_code = store), '전 지점')), 1) OVER (ORDER BY sort) AS PRE_STORE_NM,
		        LAG(title, 1, '이전글이 없습니다') OVER (ORDER BY sort) AS PRE_TITLE
		    FROM banewstb_mu
		    where is_show = 'Y' and start_ymd <![CDATA[<=]]> TO_CHAR(SYSDATE, 'YYYYMMDD') and end_ymd <![CDATA[>=]]> TO_CHAR(SYSDATE, 'YYYYMMDD')
		) A
		where seq = '${seq}'
	</select>
	<update id="upNewsViews" parameterType="hashmap">
		update banewstb_mu 
        set 
        views = nvl(banewstb_mu.views, 0) +1
        where
        seq = '${seq}'
	</update>

	<update id="lastSubmitWBREC" parameterType="String">
        UPDATE BAWBRECTB_MU 
        set 
        status = 'P'
        where
        reg_no = #{reg_no}
        and cust_no=#{cust_no}
	</update>
	
	<update id="lastSubmitWBPLA" parameterType="String">
        UPDATE bawbplatb_mu 
        set 
        submit_date = TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
        where
        reg_no = #{reg_no}
        and cust_no=#{cust_no}
	</update>
	
	
	
	 <select id="getApplyResultCount" parameterType="hashmap" resultType="hashmap">	 
			select 
                   count(*) as cnt
               from BAWBRECTB_MU a,BAWBPLATB_MU b,bacusttb c where 1=1
                   and a.cust_no = '${cust_no}'
			    and b.cust_no = a.cust_no
			    and b.reg_no = a.reg_no
			    and c.cust_no = a.cust_no
			   -- and b.submit_date is not null
		    	
	 </select>
	
	
	 <select id="getApplyResult" parameterType="hashmap" resultType="hashmap">
	 
		select
		X.*
		from ( 
		    select rownum as rnum, A.*
		    from ( 
		    	
				select 
                    a.reg_no,
                    c.kor_nm,
                    b.lec_nm,
                    TO_CHAR(TO_DATE(b.submit_date, 'YYYYMMDDHH24MISS'), 'YYYY.MM.DD') AS submit_date,
                    decode(a.status,'P','진행중','N','접수중','심사완료') as status1,
                    decode(a.status,'P','심사전','S','합격','F','불합격') as status2,
                    nvl(b.manager,'담당자를 배정해주세요') as manager
                from BAWBRECTB_MU a,BAWBPLATB_MU b,bacusttb c where 1=1
                    and a.cust_no = '${cust_no}'
				    and b.cust_no = a.cust_no
				    and b.reg_no = a.reg_no
				    and c.cust_no = a.cust_no
				   -- and b.submit_date is not null
		    	
		    	order by to_number(a.reg_no) desc
				    
		    ) A
		    where rownum <![CDATA[<=]]> #{e_rownum}) X
		where X.rnum <![CDATA[>]]> #{s_rownum}
		
	 	
	 </select>
	 
	 <select id="getContractInfoCount" parameterType="hashmap" resultType="hashmap">	 
				select 
                   count(*) as cnt
               from BACONTRACTTB aa, bapelttb bb where
				   bb.store = aa.store
				   AND bb.period = aa.period
				   AND bb.subject_cd = aa.subject_cd
                   and aa.cus_no = '${cus_no}'
                   and aa.submit_fg='Y'
				   and aa.store = '${store}'
				
		    		<if test="!start_ymd.equals('')">
						and aa.period <![CDATA[>=]]> ${start_ymd}
					</if>
					<if test="!end_ymd.equals('')">
						and aa.period <![CDATA[<=]]> ${end_ymd}
					</if>
		    
	 </select>
	
	
	 <select id="getContractInfo" parameterType="hashmap" resultType="hashmap">
	 
		select
		X.*
		from ( 
		    select rownum as rnum, A.*
		    from ( 
		    	
				select 
				   aa.store,
				   aa.period,
				   aa.subject_cd,
                   aa.confirm_yn,
                   aa.submit_fg,
                   (select short_name from bacodetb where CODE_FG = '02' and sub_code = aa.store) as store_nm,
                   TO_CHAR(TO_DATE(aa.contract_day, 'YYYYMMDDHH24MISS'), 'YYYY.MM.DD HH24:MI') as contract_day,
                   (select web_text from baperitb where
						store = aa.store
						and period = aa.period
                   ) as season_nm,
                  bb.web_lecturer_nm,
                  bb.subject_nm
               from BACONTRACTTB aa, bapelttb bb where
				   bb.store = aa.store
				   AND bb.period = aa.period
				   AND bb.subject_cd = aa.subject_cd
                   and aa.cus_no = '${cus_no}'
                   and aa.submit_fg='Y'
				   and aa.store = '${store}'
				
		    		<if test="!start_ymd.equals('')">
						and aa.period <![CDATA[>=]]> ${start_ymd}
					</if>
					<if test="!end_ymd.equals('')">
						and aa.period <![CDATA[<=]]> ${end_ymd}
					</if>
				    
				    order by to_number(aa.period) desc
		    ) A
		    where rownum <![CDATA[<=]]> #{e_rownum}) X
		where X.rnum <![CDATA[>]]> #{s_rownum}
		
	 	
	 </select>
	
	<select id="getContractInfo02" parameterType="hashmap" resultType="hashmap">
		select 
		    bb.store,
		    bb.period,
		    bb.subject_cd,
		    aa.cus_no,
		    (select short_name from bacodetb where CODE_FG = '02' and sub_code = bb.store) as store_nm,
		    cc.cus_pn,
		    bb.subject_nm,
		    decode(bb.subject_fg, '1', '정규', '2', '단기', '3', '특강') as subject_fg,
		    (select short_name from bacodetb where code_fg = '09' and sub_code = bb.main_cd) as main_nm,
		    decode(bb.fix_pay_yn,'Y','정액','정률') AS fix_pay_yn,
		    bb.day_flag,
		    TO_CHAR(TO_DATE(bb.start_ymd, 'YYYYMMDD'), 'YYYY-MM-DD') as start_ymd,
		    TO_CHAR(TO_DATE(bb.end_ymd, 'YYYYMMDD'), 'YYYY-MM-DD') as end_ymd,
		    bb.lect_hour,
		    decode(bb.fix_pay_yn,'Y',bb.fix_amt,bb.fix_rate) as lect_fee,
		    aa.contract_start,
		    aa.contract_end,
		    aa.auto_term,
		    aa.confirm_yn,
		    aa.submit_fg,
		    aa.naver_yn,
		    aa.info_yn,
		    aa.contract_day,
		    bb.regis_fee,
		    bb.food_yn,
		    bb.food_amt,
		    bb.lect_cnt
		from bacontracttb aa, bapelttb bb, ams_cus cc where
		    bb.store = aa.store
		    and bb.period = aa.period
		    and bb.subject_cd = aa.subject_cd
		    and cc.cus_no = bb.cus_no
		    and aa.store ='${store}'
		    and aa.period ='${period}'
		    and aa.subject_cd='${subject_cd}'
		    and aa.cus_no ='${cus_no}'
	</select>
	
	<update id="confirm" parameterType="hashmap">
		update bacontracttb 
		set
			contract_day = to_char(sysdate, 'yyyymmddhh24miss'),
			CONFIRM_YN='Y',
			NAVER_YN='${naver_yn}',
			INFO_YN='${info_yn}'
		where
			store = '${store}'
			and period ='${period}'
			and subject_cd ='${subject_cd}'
			and cus_no='${cus_no}'
	</update>
	
			
	<delete id="delWBREC" parameterType="hashmap">	
		DELETE FROM BAWBRECTB_MU                             
	        WHERE reg_no = '${reg_no}'                 
	        and cust_no='${cust_no}'           
	</delete>
	
	<delete id="delWBPLA" parameterType="hashmap">	
		DELETE FROM BAWBPLATB_MU                             
	        WHERE reg_no = '${reg_no}'      
	        and cust_no= '${cust_no}'                      
	</delete>
	
	<!--  
	<delete id="delCONTRACT" parameterType="hashmap">	
		DELETE FROM BACONTRACTTB                             
	        WHERE reg_no = '${reg_no}'                            
	</delete>
	-->
	<!-- 
	<delete id="delAPPLY" parameterType="hashmap">	
		DELETE FROM BAAPPLYTB                             
	        WHERE reg_no = '${reg_no}'                            
	</delete>
 	-->
	<select id="getSeason" parameterType="hashmap" resultType="hashmap">
		select 
			web_text,
			period,
			nvl(start_ymd,'') as start_ymd
		from baperitb where 
			store='${store}' 
			and web_text is not null 
			order by period desc
	</select>
	<select id="selPeriBySeason" parameterType="hashmap" resultType="string">
		select period from baperitb where web_text = '${web_text}' and store = '${search_store}'
	</select>
	<select id="getPeltDetail" parameterType="hashmap" resultType="hashmap">
		select
		(select short_name from bacodetb where CODE_FG = '02' and sub_code = bapelttb.store) as store_nm,
		bapelttb.*
		from bapelttb where store = '${store}' and period = '${period}' and subject_cd = '${subject_cd}'
	</select>


	 <select id="getLectListCount" parameterType="hashmap" resultType="hashmap">	 
			select 
		        count(*) as cnt
		    from bapelttb  where
		    	 cus_no='${cus_no}'
		        and store='${store}'
		    
	 </select>
	
	
	 <select id="getLectList" parameterType="hashmap" resultType="hashmap">
	 
		select
		X.*
		from ( 
		    select rownum as rnum, A.*
		    from ( 
		    	
			    select 
			        cus_no,
			        (select web_text from baperitb where store = bapelttb.store and period = bapelttb.period) as web_text,
			        (select short_name from bacodetb where CODE_FG = '02' and sub_code = bapelttb.store) as store_nm,
			        subject_nm,
			        start_ymd,
			        end_ymd,
			        store,
			        period,
			        (CASE WHEN SUBSTR(DAY_FLAG, 1, 1) = '1' THEN '월' ELSE '' END)||                                                                                                                                                                                                                                                       
				   (CASE WHEN SUBSTR(DAY_FLAG, 2, 1) = '1' THEN '화' ELSE '' END)||                                                                                                                                                                                                                                                       
				   (CASE WHEN SUBSTR(DAY_FLAG, 3, 1) = '1' THEN '수' ELSE '' END)||                                                                                                                                                                                                                                                       
				   (CASE WHEN SUBSTR(DAY_FLAG, 4, 1) = '1' THEN '목' ELSE '' END)||                                                                                                                                                                                                                                                       
				   (CASE WHEN SUBSTR(DAY_FLAG, 5, 1) = '1' THEN '금' ELSE '' END)||                                                                                                                                                                                                                                                      
				   (CASE WHEN SUBSTR(DAY_FLAG, 6, 1) = '1' THEN '토' ELSE '' END)||                                                                                                                                                                                                                                                      
				   (CASE WHEN SUBSTR(DAY_FLAG, 7, 1) = '1' THEN '일' ELSE '' END)    AS DAY,
			       SUBSTR(LECT_HOUR,1,2)||':'||SUBSTR(LECT_HOUR,3,2)||'-'||SUBSTR(LECT_HOUR,5,2)||':'||SUBSTR(LECT_HOUR,7,2) LECT_HOUR,
			        subject_cd
			    from bapelttb  where 
			        cus_no='${cus_no}'
			        and store='${store}'
			        
			        order by create_date desc
				    
		    ) A
		    where rownum <![CDATA[<=]]> #{e_rownum}) X
		where X.rnum <![CDATA[>]]> #{s_rownum}
		
	 	
	 </select>
	 
	 <select id="getAttendListCount" parameterType="hashmap" resultType="hashmap">	 
	    select 
            count(*) as cnt 
        from baattendtb a, bacusttb b where 1=1
            and b.cust_no = a.cust_no
            and a.store='${store}'
            and a.period='${period}'
            and a.subject_cd='${subject_cd}'
            and a.is_lec='N'
		    
	 </select>
	
	
	 <select id="getAttendList" parameterType="hashmap" resultType="hashmap">
	 
		select
		X.*
		from ( 
		    select rownum as rnum, A.*
		    from ( 
		    	
			    select 
		            b.kor_nm,
		            b.ptl_id,
					trim(b.h_phone_no_1)||'-'||trim(b.h_phone_no_2)||'-'||trim(b.h_phone_no_3) as phone_no,
					decode(b.sex_fg,'F','여','남') as sex_fg,
					b.create_date as cust_date,
					decode((select MIN(PERIOD) AS COUNT FROM BAPERETB where
					store= a.store
					and cust_no = a.cust_no
					and period <![CDATA[<]]>
					a.period GROUP BY CUST_NO),'','신규','기존') as cust_fg,
		            
		            a.* 
		        from baattendtb a, bacusttb b where 1=1
		            and b.cust_no = a.cust_no
		            and a.store='${store}'
		            and a.period='${period}'
		            and a.subject_cd='${subject_cd}'
		            and a.is_lec='N'
				    
		    ) A
		    where rownum <![CDATA[<=]]> #{e_rownum}) X
		where X.rnum <![CDATA[>]]> #{s_rownum}
		
	 	
	 </select>
	 
	<update id="uptAttendList" parameterType="hashmap">
		update baattendtb 
		set
			day_chk='${chklist}',
			content='${content}'
		where
			store='${store}'
			and period='${period}'
			and subject_cd ='${subject_cd}'
			and cust_no = '${cust_no}'
	</update>
	
	 <select id="getLecrInfo" parameterType="hashmap" resultType="hashmap">	 
        	
		select
			p.web_lecturer_nm,
			p.subject_nm,
			(select short_name from bacodetb where CODE_FG = '02' and sub_code = p.store)
			as store_nm,
			(select short_name from bacodetb where code_fg = '09' and sub_code =
			p.main_cd) as main_nm,
			ba_sect_nm('00', p.store, p.main_cd, p.sect_cd) as sect_nm,
			p.day_flag,
            p.lect_hour,
			(CASE WHEN SUBSTR(p.DAY_FLAG, 1, 1) = '1' THEN '월' ELSE '' END)||                                                                                                                                                                                                                                                       
		   (CASE WHEN SUBSTR(p.DAY_FLAG, 2, 1) = '1' THEN '화' ELSE '' END)||                                                                                                                                                                                                                                                       
		   (CASE WHEN SUBSTR(p.DAY_FLAG, 3, 1) = '1' THEN '수' ELSE '' END)||                                                                                                                                                                                                                                                       
		   (CASE WHEN SUBSTR(p.DAY_FLAG, 4, 1) = '1' THEN '목' ELSE '' END)||                                                                                                                                                                                                                                                       
		   (CASE WHEN SUBSTR(p.DAY_FLAG, 5, 1) = '1' THEN '금' ELSE '' END)||                                                                                                                                                                                                                                                      
		   (CASE WHEN SUBSTR(p.DAY_FLAG, 6, 1) = '1' THEN '토' ELSE '' END)||                                                                                                                                                                                                                                                      
		   (CASE WHEN SUBSTR(p.DAY_FLAG, 7, 1) = '1' THEN '일' ELSE '' END)    AS DAY,                                                                                                                                                                                                                                          
 			SUBSTR(p.LECT_HOUR,1,2)||':'||SUBSTR(p.LECT_HOUR,3,2)||'-'||SUBSTR(p.LECT_HOUR,5,2)||':'||SUBSTR(p.LECT_HOUR,7,2) LECT_HOUR_SET , 
			
			a.*
		from baattendtb a,bapelttb p where 1=1
			and a.store='${store}'
			and a.period='${period}'
			and a.subject_cd ='${subject_cd}'
			and a.is_lec='Y'
			and p.store = a.store
			and p.period = a.period
			and trim(p.subject_cd) = trim(a.subject_cd)
		    
	 </select>
	 
	 <select id="getReview" parameterType="hashmap" resultType="hashmap">	 
	    select 
		   content,                                                                                                                                                                                           
		   reco_yn
        from bareviewtb where 1=1
        	and store='${store}'
        	and period ='${period}'
        	and subject_cd ='${subject_cd}'
        	and cust_no='${cust_no}'
		    
	 </select>
	 
	<update id="uptReview" parameterType="hashmap">
		update bareviewtb 
		set
			reco_yn='${reco_yn}',
			content='${content}'
		where
        	store='${store}'
        	and period ='${period}'
        	and subject_cd ='${subject_cd}'
        	and cust_no='${cust_no}'
	</update>
	<insert id="insReview" parameterType="hashmap">
		insert into BAREVIEWTB
		(STORE, PERIOD, CUST_NO,SUBJECT_CD, CONTENT, RECO_YN, CREATE_DATE)
		VALUES
		('${store}','${period}','${cust_no}','${subject_cd}','${content}', '${reco_yn}', TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'))
	</insert>
	
	<update id="delReview" parameterType="hashmap">
		update bareviewtb 
		set
			reco_yn='N',
			content=''
		where
        	store='${store}'
        	and period ='${period}'
        	and subject_cd ='${subject_cd}'
        	and cust_no='${cust_no}'
	</update>
	 <select id="getPlanDetail" parameterType="hashmap" resultType="hashmap">
		select * from bawlectb where store = '${store}' and period = '${period}' and subject_cd = '${subject_cd}'
	</select>
	<select id="getPeltOne" parameterType="hashmap" resultType="hashmap">
		select
		(select bmd from ams_cus where cus_no = bapelttb.cus_no) as bmd,
		(select short_name from bacodetb where code_fg = '09' and sub_code = bapelttb.main_cd) as MAIN_NM,
	    (select sect_nm from basecttb where store = '${store}' and main_cd = bapelttb.main_cd and sect_cd = bapelttb.sect_cd) as SECT_NM,
	    (select room_nm from baroomtb where seq_no = bapelttb.classroom) as room_nm,
	    (select short_name from bacodetb where code_fg = '02' and sub_code = bapelttb.store) as STORE_NAME,
	    balecttb.lect_cd,
	    (select round((length(replace(etc, '회차 : ', '|')) - length(replace(replace(etc, '회차 : ', '|'), '|', ''))) / bapelttb.lect_cnt * 100) from bawlectb where store = bapelttb.store and period = bapelttb.period and subject_cd = bapelttb.subject_cd) as plan_cnt,
		bapelttb.*
		from bapelttb, balecttb
		where bapelttb.store = '${store}' and bapelttb.period = '${period}' and bapelttb.subject_cd = '${subject_cd}' and balecttb.store = '${store}' and balecttb.subject_cd = '${subject_cd}'
	</select>
	<update id="upPlan" parameterType="hashmap">

		update bawlectb
		set
		subject_nm = '${subject_nm}',
		lecturer_nm = '${lecturer_nm}',
		lecturer_career = '${lecturer_career}',
		lecture_content = '${lecture_content}',
		etc = '${etc}',
		update_resi_no = '${login_seq}',
		update_date = TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'),
		image_pic = '${filename}'
		where
		store = '${store}' and period = '${period}' and subject_cd = '${subject_cd}'
	</update>
	<insert id="insPlan" parameterType="hashmap">
		insert into bawlectb
		(HQ, STORE, PERIOD, SUBJECT_CD, subject_nm, lecturer_nm, lecturer_career, lecture_content, etc, update_resi_no, update_date, image_pic)
		VALUES
		('00', '${store}', '${period}', '${subject_cd}', '${subject_nm}', '${lecturer_nm}', '${lecturer_career}', '${lecture_content}', '${etc}', '${login_seq}', TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'), '${filanem}')
	</insert>
	<select id="getRecoList" parameterType="hashmap" resultType="hashmap">
	 
		select
		X.*
		from ( 
		    select rownum as rnum, A.*
		    from ( 
		    	select
				decode(bapelttb.subject_fg, '1', '정규', '2', '단기', '3', '특강') as SUBJECT_FG_NM,
				(select short_name from bacodetb where code_fg = '09' and sub_code = bapelttb.main_cd) as MAIN_NM,
				(select short_name from bacodetb where CODE_FG = '02' and sub_code = bapelttb.store) as store_nm,
				ba_sect_nm('00', bapelttb.store, bapelttb.main_cd, bapelttb.sect_cd) as sect_nm,    
				bapelttb.thumbnail_img as thumbnail,
				bapelttb.CAPACITY_NO - (NVL(bapelttb.WEB_REGIS_NO,0) + NVL(bapelttb.REGIS_NO,0)+
				( select count(*) from bawaittb where store = bapelttb.store and period = bapelttb.period and subject_cd = bapelttb.subject_cd and delete_fg = '1'))
				POSSIBLE_NO, 	
				barecotb_mu.tag,
				bapelttb.*
				
				from 
				bapelttb,
				barecotb_mu
				where bapelttb.store = barecotb_mu.store
				and bapelttb.period = barecotb_mu.period
				and bapelttb.subject_cd = barecotb_mu.subject_cd
				and barecotb_mu.is_show = 'Y'
				and barecotb_mu.start_ymd <![CDATA[<=]]> TO_CHAR(SYSDATE, 'YYYYMMDD')
				and barecotb_mu.end_ymd <![CDATA[>=]]> TO_CHAR(SYSDATE, 'YYYYMMDD')
				<if test="!tag.equals('')">
					and barecotb_mu.tag like '%'||'${tag}'||'%'
				</if>
				order by barecotb_mu.sort
		    ) A
		    where rownum <![CDATA[<=]]> #{e_rownum}) X
		where X.rnum <![CDATA[>]]> #{s_rownum}
		
	 	
	 </select>
	 <select id="getRecoCount" parameterType="hashmap" resultType="hashmap">
		select
		count(*) as cnt
		from 
		barecotb_mu
		where is_show = 'Y'
		and start_ymd <![CDATA[<=]]> TO_CHAR(SYSDATE, 'YYYYMMDD')
		and end_ymd <![CDATA[>=]]> TO_CHAR(SYSDATE, 'YYYYMMDD')
		<if test="!tag.equals('')">
			and tag like '%'||'${tag}'||'%'
		</if>
	</select>
	<select id="getPeltMid" parameterType="hashmap" resultType="hashmap">
		select
		(select bmd from ams_cus where cus_no = bapelttb.cus_no) as bmd,
		bapelttb.*
		from bapelttb 
		where store = '${store}' and period = '${period}' and subject_cd = '${subject_cd}'
	</select>
	<select id="getHoliday" parameterType="hashmap" resultType="hashmap">
		select * from baperitb where STORE = '${store}' and PERIOD = '${period}' 
	</select>
	
	<update id="uptMarrySNS" parameterType="hashmap">
		 update bacusttb                             
	     	set
	            marry_fg = '${marry_fg}',
	            sns_url ='${sns_url}'
	        where 
	        	cust_no  = '${cust_no}'                          
	</update>
	
	<select id="getMarrySNS" parameterType="hashmap" resultType="hashmap">	 
	    select 
		   nvl(marry_fg,'-') as marry_fg,                                                                                                                                                                                           
		   nvl(sns_url,'-') as sns_url
        from bacusttb where cust_no='${cust_no}'
		    
	 </select>
	 <select id="getAttendInfo" parameterType="hashmap" resultType="hashmap">
		select * from baattendtb where store ='${store}' and period ='${period}' and subject_cd ='${subject_cd}' and is_lec='Y'
	</select>
	<insert id="insAttend" parameterType="hashmap">
		insert into BAATTENDTB
		(STORE,PERIOD,SUBJECT_CD,CREATE_DATE,CREATE_RESI_NO,IS_LEC,CUST_NO,DAY_CHK, p_cust, c_cust1, c_cust2)
		VALUES
		('${store}','${period}', '${subject_cd}', TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'), '${login_seq}','${isLec}','${cust_no}','${dayVal}', '${p_cust}', '${c_cust1}', '${c_cust2}')
	</insert>
	
	<delete id="delChild" parameterType="hashmap">
        update bachildtb_mu set
        use_yn ='N'
		where cust_no = '${cust_no}'
		and child_no = '${child_no}'
	</delete>
</mapper>